<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Moodle PHP Documentation: backup_cron_automated_helper Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Moodle PHP Documentation"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Moodle-Logo-ReversedWhite_RGB.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Moodle PHP Documentation<span id="projectnumber">&#160;4.1</span>
   </div>
   <div id="projectbrief">Moodle 4.1.4+ (Build: 20230616) (64b701190d3)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.php','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pro-static-methods">Static Protected Member Functions</a> &#124;
<a href="../../de/dd4/classbackup__cron__automated__helper-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">backup_cron_automated_helper Class Reference<div class="ingroups"><a class="el" href="../../d0/de1/group__core.html">core</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>This class is an abstract class with methods that can be called to aid the running of automated backups over cron.  
 <a href="../../d7/dea/classbackup__cron__automated__helper.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:ac41ca4dc1e4b96253bb62d9312057488"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/classbackup__cron__automated__helper.html#ac41ca4dc1e4b96253bb62d9312057488">calculate_next_automated_backup</a> ($ignoredtimezone, $now)</td></tr>
<tr class="memdesc:ac41ca4dc1e4b96253bb62d9312057488"><td class="mdescLeft">&#160;</td><td class="mdescRight">Works out the next time the automated backup should be run.  <br /></td></tr>
<tr class="separator:ac41ca4dc1e4b96253bb62d9312057488"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1066749e18e93e5aeb73d1b8dcb5dc2c"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/classbackup__cron__automated__helper.html#a1066749e18e93e5aeb73d1b8dcb5dc2c">get_automated_backup_lock</a> ($rundirective=self::RUN_ON_SCHEDULE)</td></tr>
<tr class="memdesc:a1066749e18e93e5aeb73d1b8dcb5dc2c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Try to get lock for automated backup.  <br /></td></tr>
<tr class="separator:a1066749e18e93e5aeb73d1b8dcb5dc2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9541aff2bf3aed12947c2f03c1a2eba3"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/classbackup__cron__automated__helper.html#a9541aff2bf3aed12947c2f03c1a2eba3">get_backup_status_array</a> ()</td></tr>
<tr class="memdesc:a9541aff2bf3aed12947c2f03c1a2eba3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the results from the last automated backup that was run based upon the statuses of the courses that were looked at.  <br /></td></tr>
<tr class="separator:a9541aff2bf3aed12947c2f03c1a2eba3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af550792c73ddb9308c17a7eaf2133e8a"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/classbackup__cron__automated__helper.html#af550792c73ddb9308c17a7eaf2133e8a">launch_automated_backup</a> ($course, $starttime, $userid)</td></tr>
<tr class="memdesc:af550792c73ddb9308c17a7eaf2133e8a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Launches a automated backup routine for the given course.  <br /></td></tr>
<tr class="separator:af550792c73ddb9308c17a7eaf2133e8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab531b20294a5f76c5afad1b7805a254"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/classbackup__cron__automated__helper.html#aab531b20294a5f76c5afad1b7805a254">outcome_from_results</a> ($results)</td></tr>
<tr class="memdesc:aab531b20294a5f76c5afad1b7805a254"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the backup outcome by analysing its results.  <br /></td></tr>
<tr class="separator:aab531b20294a5f76c5afad1b7805a254"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc7c68354218ae14f5073c0626946f9d"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/classbackup__cron__automated__helper.html#acc7c68354218ae14f5073c0626946f9d">remove_deleted_courses_from_schedule</a> ()</td></tr>
<tr class="memdesc:acc7c68354218ae14f5073c0626946f9d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes deleted courses fromn the backup_courses table so that we don't waste time backing them up.  <br /></td></tr>
<tr class="separator:acc7c68354218ae14f5073c0626946f9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac704d68250075c09b4df5a5bea3edf3c"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/classbackup__cron__automated__helper.html#ac704d68250075c09b4df5a5bea3edf3c">remove_excess_backups</a> ($course, $now=null)</td></tr>
<tr class="memdesc:ac704d68250075c09b4df5a5bea3edf3c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes excess backups from a specified course.  <br /></td></tr>
<tr class="separator:ac704d68250075c09b4df5a5bea3edf3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a792dd012acb645e4e60102a585c8341c"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/classbackup__cron__automated__helper.html#a792dd012acb645e4e60102a585c8341c">run_automated_backup</a> ($rundirective=self::RUN_ON_SCHEDULE)</td></tr>
<tr class="memdesc:a792dd012acb645e4e60102a585c8341c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Runs the automated backups if required.  <br /></td></tr>
<tr class="separator:a792dd012acb645e4e60102a585c8341c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a6f201cd9631dd2316c4cdf57693c2976"><td class="memItemLeft" align="right" valign="top"><a id="a6f201cd9631dd2316c4cdf57693c2976" name="a6f201cd9631dd2316c4cdf57693c2976"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><b>AUTO_BACKUP_DISABLED</b> = 0</td></tr>
<tr class="separator:a6f201cd9631dd2316c4cdf57693c2976"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acca9651914f9bff969b6cc38245a3340"><td class="memItemLeft" align="right" valign="top"><a id="acca9651914f9bff969b6cc38245a3340" name="acca9651914f9bff969b6cc38245a3340"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><b>AUTO_BACKUP_ENABLED</b> = 1</td></tr>
<tr class="separator:acca9651914f9bff969b6cc38245a3340"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab040a8fa424d945d1fe787b4d20c1f82"><td class="memItemLeft" align="right" valign="top"><a id="ab040a8fa424d945d1fe787b4d20c1f82" name="ab040a8fa424d945d1fe787b4d20c1f82"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><b>AUTO_BACKUP_MANUAL</b> = 2</td></tr>
<tr class="separator:ab040a8fa424d945d1fe787b4d20c1f82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a926f3c4277ae0eaa107841d661af1481"><td class="memItemLeft" align="right" valign="top"><a id="a926f3c4277ae0eaa107841d661af1481" name="a926f3c4277ae0eaa107841d661af1481"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><b>BACKUP_STATUS_ERROR</b> = 0</td></tr>
<tr class="memdesc:a926f3c4277ae0eaa107841d661af1481"><td class="mdescLeft">&#160;</td><td class="mdescRight">Course automated backup errored. <br /></td></tr>
<tr class="separator:a926f3c4277ae0eaa107841d661af1481"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf58a1f4dbe9d5e898b2f70e0f6b0f9a"><td class="memItemLeft" align="right" valign="top"><a id="abf58a1f4dbe9d5e898b2f70e0f6b0f9a" name="abf58a1f4dbe9d5e898b2f70e0f6b0f9a"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><b>BACKUP_STATUS_NOTYETRUN</b> = 5</td></tr>
<tr class="memdesc:abf58a1f4dbe9d5e898b2f70e0f6b0f9a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Course automated backup has yet to be run. <br /></td></tr>
<tr class="separator:abf58a1f4dbe9d5e898b2f70e0f6b0f9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b262605f00e832f2f94280f29c98fd2"><td class="memItemLeft" align="right" valign="top"><a id="a2b262605f00e832f2f94280f29c98fd2" name="a2b262605f00e832f2f94280f29c98fd2"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><b>BACKUP_STATUS_OK</b> = 1</td></tr>
<tr class="memdesc:a2b262605f00e832f2f94280f29c98fd2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Course automated backup completed successfully. <br /></td></tr>
<tr class="separator:a2b262605f00e832f2f94280f29c98fd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a94afe0b2ba56236b8678f4d7f0dc2b09"><td class="memItemLeft" align="right" valign="top"><a id="a94afe0b2ba56236b8678f4d7f0dc2b09" name="a94afe0b2ba56236b8678f4d7f0dc2b09"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><b>BACKUP_STATUS_QUEUED</b> = 6</td></tr>
<tr class="memdesc:a94afe0b2ba56236b8678f4d7f0dc2b09"><td class="mdescLeft">&#160;</td><td class="mdescRight">Course automated backup has been added to adhoc task queue. <br /></td></tr>
<tr class="separator:a94afe0b2ba56236b8678f4d7f0dc2b09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7dd5ad0c6657a0c2e2ff27a1d5c7cb5"><td class="memItemLeft" align="right" valign="top"><a id="ab7dd5ad0c6657a0c2e2ff27a1d5c7cb5" name="ab7dd5ad0c6657a0c2e2ff27a1d5c7cb5"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><b>BACKUP_STATUS_SKIPPED</b> = 3</td></tr>
<tr class="memdesc:ab7dd5ad0c6657a0c2e2ff27a1d5c7cb5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Course automated backup was skipped. <br /></td></tr>
<tr class="separator:ab7dd5ad0c6657a0c2e2ff27a1d5c7cb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c416b68ba4e63b305170d7ef4503193"><td class="memItemLeft" align="right" valign="top"><a id="a5c416b68ba4e63b305170d7ef4503193" name="a5c416b68ba4e63b305170d7ef4503193"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><b>BACKUP_STATUS_UNFINISHED</b> = 2</td></tr>
<tr class="memdesc:a5c416b68ba4e63b305170d7ef4503193"><td class="mdescLeft">&#160;</td><td class="mdescRight">Course automated backup never finished. <br /></td></tr>
<tr class="separator:a5c416b68ba4e63b305170d7ef4503193"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e6fb2316b1dbe1767c01ae4c9e2bf30"><td class="memItemLeft" align="right" valign="top"><a id="a9e6fb2316b1dbe1767c01ae4c9e2bf30" name="a9e6fb2316b1dbe1767c01ae4c9e2bf30"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><b>BACKUP_STATUS_WARNING</b> = 4</td></tr>
<tr class="memdesc:a9e6fb2316b1dbe1767c01ae4c9e2bf30"><td class="mdescLeft">&#160;</td><td class="mdescRight">Course automated backup had warnings. <br /></td></tr>
<tr class="separator:a9e6fb2316b1dbe1767c01ae4c9e2bf30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af292e756931dbb42b62b6743b64884de"><td class="memItemLeft" align="right" valign="top"><a id="af292e756931dbb42b62b6743b64884de" name="af292e756931dbb42b62b6743b64884de"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><b>RUN_IMMEDIATELY</b> = 1</td></tr>
<tr class="memdesc:af292e756931dbb42b62b6743b64884de"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run immediately. <br /></td></tr>
<tr class="separator:af292e756931dbb42b62b6743b64884de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a842f4d0d6999ba9dff888de0c6e34b29"><td class="memItemLeft" align="right" valign="top">const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/classbackup__cron__automated__helper.html#a842f4d0d6999ba9dff888de0c6e34b29">RUN_ON_SCHEDULE</a> = 0</td></tr>
<tr class="memdesc:a842f4d0d6999ba9dff888de0c6e34b29"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run if required by the schedule set in config.  <br /></td></tr>
<tr class="separator:a842f4d0d6999ba9dff888de0c6e34b29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bae3b92f276ca8aa5023dce78aa0e88"><td class="memItemLeft" align="right" valign="top"><a id="a4bae3b92f276ca8aa5023dce78aa0e88" name="a4bae3b92f276ca8aa5023dce78aa0e88"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><b>STATE_DISABLED</b> = 1</td></tr>
<tr class="memdesc:a4bae3b92f276ca8aa5023dce78aa0e88"><td class="mdescLeft">&#160;</td><td class="mdescRight">Automated backups are disabled and will not be run. <br /></td></tr>
<tr class="separator:a4bae3b92f276ca8aa5023dce78aa0e88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70a0643f344d806a703dbc7baae0423a"><td class="memItemLeft" align="right" valign="top"><a id="a70a0643f344d806a703dbc7baae0423a" name="a70a0643f344d806a703dbc7baae0423a"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><b>STATE_OK</b> = 0</td></tr>
<tr class="memdesc:a70a0643f344d806a703dbc7baae0423a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Automated backups are active and ready to run. <br /></td></tr>
<tr class="separator:a70a0643f344d806a703dbc7baae0423a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7cd5fcf496089c65dde2008b9ea84a7c"><td class="memItemLeft" align="right" valign="top"><a id="a7cd5fcf496089c65dde2008b9ea84a7c" name="a7cd5fcf496089c65dde2008b9ea84a7c"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><b>STATE_RUNNING</b> = 2</td></tr>
<tr class="memdesc:a7cd5fcf496089c65dde2008b9ea84a7c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Automated backups are all ready running! <br /></td></tr>
<tr class="separator:a7cd5fcf496089c65dde2008b9ea84a7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa06ae545782d2e4cb0639658cc1acf6b"><td class="memItemLeft" align="right" valign="top"><a id="aa06ae545782d2e4cb0639658cc1acf6b" name="aa06ae545782d2e4cb0639658cc1acf6b"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><b>STORAGE_COURSE</b> = 0</td></tr>
<tr class="memdesc:aa06ae545782d2e4cb0639658cc1acf6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Automated backup storage in course backup filearea. <br /></td></tr>
<tr class="separator:aa06ae545782d2e4cb0639658cc1acf6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a7288d3f5e9be234545bef38274c4d2"><td class="memItemLeft" align="right" valign="top"><a id="a6a7288d3f5e9be234545bef38274c4d2" name="a6a7288d3f5e9be234545bef38274c4d2"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><b>STORAGE_COURSE_AND_DIRECTORY</b> = 2</td></tr>
<tr class="memdesc:a6a7288d3f5e9be234545bef38274c4d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Automated backup storage in course backup filearea and specified directory. <br /></td></tr>
<tr class="separator:a6a7288d3f5e9be234545bef38274c4d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97c38aa33fab8f808f857e1f8ca93c75"><td class="memItemLeft" align="right" valign="top"><a id="a97c38aa33fab8f808f857e1f8ca93c75" name="a97c38aa33fab8f808f857e1f8ca93c75"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><b>STORAGE_DIRECTORY</b> = 1</td></tr>
<tr class="memdesc:a97c38aa33fab8f808f857e1f8ca93c75"><td class="mdescLeft">&#160;</td><td class="mdescRight">Automated backup storage in specified directory. <br /></td></tr>
<tr class="separator:a97c38aa33fab8f808f857e1f8ca93c75"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-static-methods" name="pro-static-methods"></a>
Static Protected Member Functions</h2></td></tr>
<tr class="memitem:ac826b928eeedf7c9de79135f27689193"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/classbackup__cron__automated__helper.html#ac826b928eeedf7c9de79135f27689193">get_backups_to_delete</a> ($backupfiles, $now)</td></tr>
<tr class="memdesc:ac826b928eeedf7c9de79135f27689193"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the list of backup files to delete depending on the automated backup settings.  <br /></td></tr>
<tr class="separator:ac826b928eeedf7c9de79135f27689193"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37dcbbdaac414b11a3d4ef2fb6ad7a00"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/classbackup__cron__automated__helper.html#a37dcbbdaac414b11a3d4ef2fb6ad7a00">get_courses</a> ($now=null)</td></tr>
<tr class="memdesc:a37dcbbdaac414b11a3d4ef2fb6ad7a00"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the courses to backup.  <br /></td></tr>
<tr class="separator:a37dcbbdaac414b11a3d4ef2fb6ad7a00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae670ba6eb95813114e290af19a01f0c0"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/classbackup__cron__automated__helper.html#ae670ba6eb95813114e290af19a01f0c0">is_course_modified</a> ($courseid, $since)</td></tr>
<tr class="memdesc:ae670ba6eb95813114e290af19a01f0c0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check logs to find out if a course was modified since the given time.  <br /></td></tr>
<tr class="separator:ae670ba6eb95813114e290af19a01f0c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d1726589070139e9ebf3f7db1c518df"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/classbackup__cron__automated__helper.html#a6d1726589070139e9ebf3f7db1c518df">remove_excess_backups_from_course</a> ($course, $now)</td></tr>
<tr class="memdesc:a6d1726589070139e9ebf3f7db1c518df"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes excess backups in the course backup filearea from a specified course.  <br /></td></tr>
<tr class="separator:a6d1726589070139e9ebf3f7db1c518df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a740e15856114e773c088fade1e9dfeef"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/classbackup__cron__automated__helper.html#a740e15856114e773c088fade1e9dfeef">remove_excess_backups_from_directory</a> ($course, $now)</td></tr>
<tr class="memdesc:a740e15856114e773c088fade1e9dfeef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes excess backups in the specified external directory from a specified course.  <br /></td></tr>
<tr class="separator:a740e15856114e773c088fade1e9dfeef"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This class is an abstract class with methods that can be called to aid the running of automated backups over cron. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="ac41ca4dc1e4b96253bb62d9312057488" name="ac41ca4dc1e4b96253bb62d9312057488"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac41ca4dc1e4b96253bb62d9312057488">&#9670;&#160;</a></span>calculate_next_automated_backup()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static backup_cron_automated_helper::calculate_next_automated_backup </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$ignoredtimezone</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Works out the next time the automated backup should be run. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">mixed</td><td class="paramname">$ignoredtimezone</td><td>all settings are in server timezone! </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$now</td><td>timestamp, should not be in the past, most likely time() </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td>timestamp of the next execution at server time </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a1066749e18e93e5aeb73d1b8dcb5dc2c" name="a1066749e18e93e5aeb73d1b8dcb5dc2c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1066749e18e93e5aeb73d1b8dcb5dc2c">&#9670;&#160;</a></span>get_automated_backup_lock()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static backup_cron_automated_helper::get_automated_backup_lock </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$rundirective</em> = <code>self::RUN_ON_SCHEDULE</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Try to get lock for automated backup. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$rundirective</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">core::lock::lock|boolean</td><td>- An instance of core\lock\lock if the lock was obtained, or false. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9541aff2bf3aed12947c2f03c1a2eba3" name="a9541aff2bf3aed12947c2f03c1a2eba3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9541aff2bf3aed12947c2f03c1a2eba3">&#9670;&#160;</a></span>get_backup_status_array()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static backup_cron_automated_helper::get_backup_status_array </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets the results from the last automated backup that was run based upon the statuses of the courses that were looked at. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac826b928eeedf7c9de79135f27689193" name="ac826b928eeedf7c9de79135f27689193"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac826b928eeedf7c9de79135f27689193">&#9670;&#160;</a></span>get_backups_to_delete()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static backup_cron_automated_helper::get_backups_to_delete </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$backupfiles</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the list of backup files to delete depending on the automated backup settings. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$backupfiles</td><td>Existing backup files </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$now</td><td>Starting time of the process </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>Backup files to delete </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a37dcbbdaac414b11a3d4ef2fb6ad7a00" name="a37dcbbdaac414b11a3d4ef2fb6ad7a00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a37dcbbdaac414b11a3d4ef2fb6ad7a00">&#9670;&#160;</a></span>get_courses()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static backup_cron_automated_helper::get_courses </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$now</em> = <code>null</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the courses to backup. </p>
<p>When there are multiple courses to backup enforce some order to the record set. The following is the preference order. First backup courses that do not have an entry in backup_courses first, as they are likely new and never been backed up. Do the oldest modified courses first. Then backup courses that have previously been backed up starting with the oldest next start time. Finally, all else being equal, defer to the sortorder of the courses.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">null&#160;|&#160;int</td><td class="paramname">$now</td><td>timestamp to use in course selection. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="../../d6/d34/classmoodle__recordset.html" title="Abstract class for resultsets returned from database functions.">moodle_recordset</a></td><td>The recordset of matching courses. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ae670ba6eb95813114e290af19a01f0c0" name="ae670ba6eb95813114e290af19a01f0c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae670ba6eb95813114e290af19a01f0c0">&#9670;&#160;</a></span>is_course_modified()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static backup_cron_automated_helper::is_course_modified </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$courseid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$since</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check logs to find out if a course was modified since the given time. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$courseid</td><td>course id to check </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$since</td><td>timestamp, from which to check</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>true if the course was modified, false otherwise. This also returns false if no readers are enabled. This is intentional, since we cannot reliably determine if any modification was made or not. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af550792c73ddb9308c17a7eaf2133e8a" name="af550792c73ddb9308c17a7eaf2133e8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af550792c73ddb9308c17a7eaf2133e8a">&#9670;&#160;</a></span>launch_automated_backup()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static backup_cron_automated_helper::launch_automated_backup </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$course</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$starttime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$userid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Launches a automated backup routine for the given course. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass</td><td class="paramname">$course</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$starttime</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userid</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aab531b20294a5f76c5afad1b7805a254" name="aab531b20294a5f76c5afad1b7805a254"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab531b20294a5f76c5afad1b7805a254">&#9670;&#160;</a></span>outcome_from_results()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static backup_cron_automated_helper::outcome_from_results </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$results</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the backup outcome by analysing its results. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$results</td><td>returned by a backup </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td><a class="el" href="../../">self::BACKUP_STATUS_OK</a> and other constants </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="acc7c68354218ae14f5073c0626946f9d" name="acc7c68354218ae14f5073c0626946f9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc7c68354218ae14f5073c0626946f9d">&#9670;&#160;</a></span>remove_deleted_courses_from_schedule()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static backup_cron_automated_helper::remove_deleted_courses_from_schedule </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Removes deleted courses fromn the backup_courses table so that we don't waste time backing them up. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac704d68250075c09b4df5a5bea3edf3c" name="ac704d68250075c09b4df5a5bea3edf3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac704d68250075c09b4df5a5bea3edf3c">&#9670;&#160;</a></span>remove_excess_backups()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static backup_cron_automated_helper::remove_excess_backups </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$course</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$now</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Removes excess backups from a specified course. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass</td><td class="paramname">$course</td><td>Course object </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$now</td><td>Starting time of the process </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>Whether or not backups is being removed </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a6d1726589070139e9ebf3f7db1c518df" name="a6d1726589070139e9ebf3f7db1c518df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d1726589070139e9ebf3f7db1c518df">&#9670;&#160;</a></span>remove_excess_backups_from_course()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static backup_cron_automated_helper::remove_excess_backups_from_course </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$course</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Removes excess backups in the course backup filearea from a specified course. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass</td><td class="paramname">$course</td><td>Course object </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$now</td><td>Starting time of the process </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>Whether or not backups are being removed </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a740e15856114e773c088fade1e9dfeef" name="a740e15856114e773c088fade1e9dfeef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a740e15856114e773c088fade1e9dfeef">&#9670;&#160;</a></span>remove_excess_backups_from_directory()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static backup_cron_automated_helper::remove_excess_backups_from_directory </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$course</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Removes excess backups in the specified external directory from a specified course. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass</td><td class="paramname">$course</td><td>Course object </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$now</td><td>Starting time of the process </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>Whether or not backups are being removed </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a792dd012acb645e4e60102a585c8341c" name="a792dd012acb645e4e60102a585c8341c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a792dd012acb645e4e60102a585c8341c">&#9670;&#160;</a></span>run_automated_backup()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static backup_cron_automated_helper::run_automated_backup </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$rundirective</em> = <code>self::RUN_ON_SCHEDULE</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Runs the automated backups if required. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">bool</td><td class="paramname">$rundirective</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a842f4d0d6999ba9dff888de0c6e34b29" name="a842f4d0d6999ba9dff888de0c6e34b29"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a842f4d0d6999ba9dff888de0c6e34b29">&#9670;&#160;</a></span>RUN_ON_SCHEDULE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const backup_cron_automated_helper::RUN_ON_SCHEDULE = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Run if required by the schedule set in config. </p>
<p>Default. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>backup/util/helper/backup_cron_helper.class.php</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 18 2023 03:12:07 for Moodle PHP Documentation by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
