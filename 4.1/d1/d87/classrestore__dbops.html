<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Moodle PHP Documentation: restore_dbops Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Moodle PHP Documentation"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Moodle-Logo-ReversedWhite_RGB.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Moodle PHP Documentation<span id="projectnumber">&#160;4.1</span>
   </div>
   <div id="projectbrief">Moodle 4.1.5 (Build: 20230814) (b156b18c721)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.php','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pro-static-methods">Static Protected Member Functions</a> &#124;
<a href="../../dc/dc1/classrestore__dbops-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">restore_dbops Class Reference<div class="ingroups"><a class="el" href="../../d6/d9f/group__moodlecore.html">moodlecore</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Base abstract class for all the helper classes providing <a class="el" href="../../d1/dc8/class_d_b.html" title="The main &quot;DB&quot; class is simply a container class with some static methods for creating DB objects as w...">DB</a> operations.  
 <a href="../../d1/d87/classrestore__dbops.html#details">More...</a></p>
<div class="dynheader">
Inheritance diagram for restore_dbops:</div>
<div class="dyncontent">
 <div class="center">
  <img src="../../d1/d87/classrestore__dbops.png" usemap="#restore_5Fdbops_map" alt=""/>
  <map id="restore_5Fdbops_map" name="restore_5Fdbops_map">
<area href="../../db/d33/classrestore__controller__dbops.html" title="Non instantiable helper class providing DB support to the @restore_controller." alt="restore_controller_dbops" shape="rect" coords="0,56,154,80"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a2e4f8a62c242d291ac68d9c1a801b727"><td class="memItemLeft" align="right" valign="top"><a id="a2e4f8a62c242d291ac68d9c1a801b727" name="a2e4f8a62c242d291ac68d9c1a801b727"></a>
static&#160;</td><td class="memItemRight" valign="bottom"><b>calculate_course_names</b> ($courseid, $<a class="el" href="../../d0/de1/group__core.html#ga22ae943f55a27f3b9cca15f8ddd05db7">fullname</a>, $shortname)</td></tr>
<tr class="memdesc:a2e4f8a62c242d291ac68d9c1a801b727"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given on courseid, fullname and shortname, calculate the correct fullname/shortname to avoid dupes. <br /></td></tr>
<tr class="separator:a2e4f8a62c242d291ac68d9c1a801b727"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b9325f5a4a59b86969cbeb30055679f"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#a2b9325f5a4a59b86969cbeb30055679f">create_included_users</a> ($basepath, $restoreid, $userid, <a class="el" href="../../db/df4/classcore_1_1progress_1_1base.html">core\progress\base</a> $progress)</td></tr>
<tr class="memdesc:a2b9325f5a4a59b86969cbeb30055679f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given one restoreid, create in <a class="el" href="../../d1/dc8/class_d_b.html" title="The main &quot;DB&quot; class is simply a container class with some static methods for creating DB objects as w...">DB</a> all the users present in backup_ids having newitemid = 0, as far as <a class="el" href="../../d1/d87/classrestore__dbops.html#a23f90410363b86d93eab6b60c0c1c69c" title="Check all the included users, deciding the action to perform for each one (mapping / creation) and re...">precheck_included_users()</a> have left them there ready to be created.  <br /></td></tr>
<tr class="separator:a2b9325f5a4a59b86969cbeb30055679f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9e661703a938c2da4eb430b14f3bf95"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../d3/d6e/classmoodle__database.html">moodle_database</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#ac9e661703a938c2da4eb430b14f3bf95">create_new_course</a> ($<a class="el" href="../../d0/de1/group__core.html#ga22ae943f55a27f3b9cca15f8ddd05db7">fullname</a>, $shortname, $categoryid)</td></tr>
<tr class="memdesc:ac9e661703a938c2da4eb430b14f3bf95"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a skeleton record within the database using the passed parameters and returns the new course id.  <br /></td></tr>
<tr class="separator:ac9e661703a938c2da4eb430b14f3bf95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d5b6f4831be62aa2cb3b9ca5ebb5711"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#a7d5b6f4831be62aa2cb3b9ca5ebb5711">delete_course_content</a> ($courseid, array $options=null)</td></tr>
<tr class="memdesc:a7d5b6f4831be62aa2cb3b9ca5ebb5711"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deletes all of the content associated with the given course (courseid)  <br /></td></tr>
<tr class="separator:a7d5b6f4831be62aa2cb3b9ca5ebb5711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac63982dd1a64e2d577254790f4829707"><td class="memItemLeft" align="right" valign="top"><a id="ac63982dd1a64e2d577254790f4829707" name="ac63982dd1a64e2d577254790f4829707"></a>
static&#160;</td><td class="memItemRight" valign="bottom"><b>get_backup_ids_record</b> ($restoreid, $itemname, $itemid)</td></tr>
<tr class="separator:ac63982dd1a64e2d577254790f4829707"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af549b41e01ef84c0177c6e4861da0a7b"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#af549b41e01ef84c0177c6e4861da0a7b">get_included_tasks</a> ($restoreid)</td></tr>
<tr class="memdesc:af549b41e01ef84c0177c6e4861da0a7b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return one array containing all the tasks that have been included in the restore process.  <br /></td></tr>
<tr class="separator:af549b41e01ef84c0177c6e4861da0a7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeafa1f3550353eb8e2e2c070a2f07784"><td class="memItemLeft" align="right" valign="top"><a id="aeafa1f3550353eb8e2e2c070a2f07784" name="aeafa1f3550353eb8e2e2c070a2f07784"></a>
static&#160;</td><td class="memItemRight" valign="bottom"><b>load_categories_and_questions_to_tempids</b> ($restoreid, $questionsfile)</td></tr>
<tr class="memdesc:aeafa1f3550353eb8e2e2c070a2f07784"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load the needed questions.xml file to backup_ids table for future reference. <br /></td></tr>
<tr class="separator:aeafa1f3550353eb8e2e2c070a2f07784"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a949f85853ebbbabbcd7495396a1fc740"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#a949f85853ebbbabbcd7495396a1fc740">load_inforef_to_tempids</a> ($restoreid, $inforeffile, <a class="el" href="../../db/df4/classcore_1_1progress_1_1base.html">core\progress\base</a> $progress=null)</td></tr>
<tr class="memdesc:a949f85853ebbbabbcd7495396a1fc740"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load one inforef.xml file to backup_ids table for future reference.  <br /></td></tr>
<tr class="separator:a949f85853ebbbabbcd7495396a1fc740"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3910d363c667719de4d5647c5aaa9872"><td class="memItemLeft" align="right" valign="top"><a id="a3910d363c667719de4d5647c5aaa9872" name="a3910d363c667719de4d5647c5aaa9872"></a>
static&#160;</td><td class="memItemRight" valign="bottom"><b>load_roles_to_tempids</b> ($restoreid, $rolesfile)</td></tr>
<tr class="memdesc:a3910d363c667719de4d5647c5aaa9872"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load the needed role.xml file to backup_ids table for future reference. <br /></td></tr>
<tr class="separator:a3910d363c667719de4d5647c5aaa9872"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf4bbe0473e45a70ff95fe8542faa633"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#abf4bbe0473e45a70ff95fe8542faa633">load_users_to_tempids</a> ($restoreid, $usersfile, <a class="el" href="../../db/df4/classcore_1_1progress_1_1base.html">core\progress\base</a> $progress=null)</td></tr>
<tr class="memdesc:abf4bbe0473e45a70ff95fe8542faa633"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load the needed users.xml file to backup_ids table for future reference.  <br /></td></tr>
<tr class="separator:abf4bbe0473e45a70ff95fe8542faa633"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fd3e17ef77aecd29911b1d129e2cd12"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#a1fd3e17ef77aecd29911b1d129e2cd12">precheck_categories_and_questions</a> ($restoreid, $courseid, $userid, $samesite)</td></tr>
<tr class="memdesc:a1fd3e17ef77aecd29911b1d129e2cd12"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check all the included categories and questions, deciding the action to perform for each one (mapping / creation) and returning one array of problems in case something is wrong.  <br /></td></tr>
<tr class="separator:a1fd3e17ef77aecd29911b1d129e2cd12"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c59fc29c2c85b491241b8946f2cea9d"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#a3c59fc29c2c85b491241b8946f2cea9d">precheck_included_roles</a> ($restoreid, $courseid, $userid, $samesite, $rolemappings)</td></tr>
<tr class="memdesc:a3c59fc29c2c85b491241b8946f2cea9d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Precheck the loaded roles, return empty array if everything is ok, and array with 'errors', 'warnings' elements (suitable to be used by restore_prechecks) with any problem found.  <br /></td></tr>
<tr class="separator:a3c59fc29c2c85b491241b8946f2cea9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23f90410363b86d93eab6b60c0c1c69c"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#a23f90410363b86d93eab6b60c0c1c69c">precheck_included_users</a> ($restoreid, $courseid, $userid, $samesite, <a class="el" href="../../db/df4/classcore_1_1progress_1_1base.html">core\progress\base</a> $progress)</td></tr>
<tr class="memdesc:a23f90410363b86d93eab6b60c0c1c69c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check all the included users, deciding the action to perform for each one (mapping / creation) and returning one array of problems in case something is wrong (lack of permissions, conficts)  <br /></td></tr>
<tr class="separator:a23f90410363b86d93eab6b60c0c1c69c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44033084ef1a15a304a808f26c80f65a"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#a44033084ef1a15a304a808f26c80f65a">prechek_precheck_qbanks_by_level</a> ($restoreid, $courseid, $userid, $samesite, $contextlevel)</td></tr>
<tr class="memdesc:a44033084ef1a15a304a808f26c80f65a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function will process all the question banks present in restore at some contextlevel (from CONTEXT_SYSTEM to CONTEXT_MODULE), finding the target contexts where each bank will be restored and returning warnings/errors as needed.  <br /></td></tr>
<tr class="separator:a44033084ef1a15a304a808f26c80f65a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae512535c95bd2497d5c0886edb5568d9"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#ae512535c95bd2497d5c0886edb5568d9">process_categories_and_questions</a> ($restoreid, $courseid, $userid, $samesite)</td></tr>
<tr class="memdesc:ae512535c95bd2497d5c0886edb5568d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process the needed question categories and questions to check all them, deciding about the action to perform (create/map) and target.  <br /></td></tr>
<tr class="separator:ae512535c95bd2497d5c0886edb5568d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ec907745ce428db1948bec2d5996af9"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#a0ec907745ce428db1948bec2d5996af9">process_included_roles</a> ($restoreid, $courseid, $userid, $samesite, $rolemappings)</td></tr>
<tr class="memdesc:a0ec907745ce428db1948bec2d5996af9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process the loaded roles, looking for their best mapping or skipping Any error will cause exception.  <br /></td></tr>
<tr class="separator:a0ec907745ce428db1948bec2d5996af9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab95ed4963c51cd1ce2ac64f0a1a7be7d"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#ab95ed4963c51cd1ce2ac64f0a1a7be7d">process_included_users</a> ($restoreid, $courseid, $userid, $samesite, <a class="el" href="../../db/df4/classcore_1_1progress_1_1base.html">core\progress\base</a> $progress=null)</td></tr>
<tr class="memdesc:ab95ed4963c51cd1ce2ac64f0a1a7be7d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process the needed users in order to decide which action to perform with them (create/map)  <br /></td></tr>
<tr class="separator:ab95ed4963c51cd1ce2ac64f0a1a7be7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad29218c85473f5dea778381a2dbf752a"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#ad29218c85473f5dea778381a2dbf752a">reset_backup_ids_cached</a> ()</td></tr>
<tr class="memdesc:ad29218c85473f5dea778381a2dbf752a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the ids caches completely.  <br /></td></tr>
<tr class="separator:ad29218c85473f5dea778381a2dbf752a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae571dbb09d7879a055b5416578188d3"><td class="memItemLeft" align="right" valign="top"><a id="aae571dbb09d7879a055b5416578188d3" name="aae571dbb09d7879a055b5416578188d3"></a>
static&#160;</td><td class="memItemRight" valign="bottom"><b>restore_find_best_target_context</b> ($categories, $courseid, $contextlevel)</td></tr>
<tr class="memdesc:aae571dbb09d7879a055b5416578188d3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the best context found to restore one collection of qcats, al them belonging to the same context (question bank), returning the target context found (object) or false. <br /></td></tr>
<tr class="separator:aae571dbb09d7879a055b5416578188d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec2d4f5a8c9d0df3cd4418b3d718dff4"><td class="memItemLeft" align="right" valign="top"><a id="aec2d4f5a8c9d0df3cd4418b3d718dff4" name="aec2d4f5a8c9d0df3cd4418b3d718dff4"></a>
static&#160;</td><td class="memItemRight" valign="bottom"><b>restore_get_question_banks</b> ($restoreid, $contextlevel=null)</td></tr>
<tr class="memdesc:aec2d4f5a8c9d0df3cd4418b3d718dff4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return one array of contextid =&gt; contextlevel pairs of question banks to be checked for one given restore operation ordered from CONTEXT_SYSTEM downto CONTEXT_MODULE If contextlevel is specified, then only banks corresponding to that level are returned. <br /></td></tr>
<tr class="separator:aec2d4f5a8c9d0df3cd4418b3d718dff4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3f17ad07c90055e6473b0ca92a3b1ee"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#ae3f17ad07c90055e6473b0ca92a3b1ee">restore_get_question_categories</a> ($restoreid, $contextid, $contextlevel)</td></tr>
<tr class="memdesc:ae3f17ad07c90055e6473b0ca92a3b1ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return one array of question_category records for a given restore operation and one restore context (question bank)  <br /></td></tr>
<tr class="separator:ae3f17ad07c90055e6473b0ca92a3b1ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a23a895ac251d6f0f682c5766ca0458"><td class="memItemLeft" align="right" valign="top"><a id="a7a23a895ac251d6f0f682c5766ca0458" name="a7a23a895ac251d6f0f682c5766ca0458"></a>
static&#160;</td><td class="memItemRight" valign="bottom"><b>restore_get_questions</b> ($restoreid, $qcatid)</td></tr>
<tr class="memdesc:a7a23a895ac251d6f0f682c5766ca0458"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return one array of question records for a given restore operation and one question category. <br /></td></tr>
<tr class="separator:a7a23a895ac251d6f0f682c5766ca0458"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88f8046313887bac3cccd1768f1a6319"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#a88f8046313887bac3cccd1768f1a6319">send_files_to_pool</a> ($basepath, $restoreid, $component, $filearea, $oldcontextid, $dfltuserid, $itemname=null, $olditemid=null, $forcenewcontextid=null, $skipparentitemidctxmatch=false, <a class="el" href="../../db/df4/classcore_1_1progress_1_1base.html">core\progress\base</a> $progress=null)</td></tr>
<tr class="memdesc:a88f8046313887bac3cccd1768f1a6319"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given one component/filearea/context and optionally one source itemname to match itemids put the corresponding files in the pool.  <br /></td></tr>
<tr class="separator:a88f8046313887bac3cccd1768f1a6319"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a403b179066cbbd4c04b6e413af193d84"><td class="memItemLeft" align="right" valign="top"><a id="a403b179066cbbd4c04b6e413af193d84" name="a403b179066cbbd4c04b6e413af193d84"></a>
static&#160;</td><td class="memItemRight" valign="bottom"><b>set_backup_files_record</b> ($restoreid, $filerec)</td></tr>
<tr class="separator:a403b179066cbbd4c04b6e413af193d84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a664593a34d479e20680a1df379b023c2"><td class="memItemLeft" align="right" valign="top"><a id="a664593a34d479e20680a1df379b023c2" name="a664593a34d479e20680a1df379b023c2"></a>
static&#160;</td><td class="memItemRight" valign="bottom"><b>set_backup_ids_record</b> ($restoreid, $itemname, $itemid, $newitemid=0, $parentitemid=null, $info=null)</td></tr>
<tr class="separator:a664593a34d479e20680a1df379b023c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adae5bdb132892cbd6289c47c1ea15c37"><td class="memItemLeft" align="right" valign="top"><a id="adae5bdb132892cbd6289c47c1ea15c37" name="adae5bdb132892cbd6289c47c1ea15c37"></a>
static&#160;</td><td class="memItemRight" valign="bottom"><b>set_course_role_names</b> ($restoreid, $courseid)</td></tr>
<tr class="memdesc:adae5bdb132892cbd6289c47c1ea15c37"><td class="mdescLeft">&#160;</td><td class="mdescRight">For the target course context, put as many custom role names as possible. <br /></td></tr>
<tr class="separator:adae5bdb132892cbd6289c47c1ea15c37"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-static-methods" name="pro-static-methods"></a>
Static Protected Member Functions</h2></td></tr>
<tr class="memitem:a90312d419e046123eafb81b7a63c8782"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#a90312d419e046123eafb81b7a63c8782">get_backup_ids_cached</a> ($restoreid, $itemname, $itemid)</td></tr>
<tr class="memdesc:a90312d419e046123eafb81b7a63c8782"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return cached backup id's.  <br /></td></tr>
<tr class="separator:a90312d419e046123eafb81b7a63c8782"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99725626983e40599d7b8f0efc9cd44d"><td class="memItemLeft" align="right" valign="top"><a id="a99725626983e40599d7b8f0efc9cd44d" name="a99725626983e40599d7b8f0efc9cd44d"></a>
static&#160;</td><td class="memItemRight" valign="bottom"><b>get_best_assignable_role</b> ($role, $courseid, $userid, $samesite)</td></tr>
<tr class="memdesc:a99725626983e40599d7b8f0efc9cd44d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given one role, as loaded from XML, perform the best possible matching against the assignable roles, using different fallback alternatives (shortname, archetype, editingteacher =&gt; teacher, defaultcourseroleid) returning the id of the best matching role or 0 if no match is found. <br /></td></tr>
<tr class="separator:a99725626983e40599d7b8f0efc9cd44d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b00ab154feefe0be906dff3f0cf5e92"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#a9b00ab154feefe0be906dff3f0cf5e92">get_missing_file_result</a> ($file)</td></tr>
<tr class="memdesc:a9b00ab154feefe0be906dff3f0cf5e92"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns suitable entry to include in log when there is a missing file.  <br /></td></tr>
<tr class="separator:a9b00ab154feefe0be906dff3f0cf5e92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c6a9b15e0be336cbb24735e2253609d"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#a7c6a9b15e0be336cbb24735e2253609d">precheck_user</a> ($user, $samesite, $siteid=null)</td></tr>
<tr class="memdesc:a7c6a9b15e0be336cbb24735e2253609d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given one user object (from backup file), perform all the neccesary checks is order to decide how that user will be handled on restore.  <br /></td></tr>
<tr class="separator:a7c6a9b15e0be336cbb24735e2253609d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3db405dc4bb2b180afa548f1f4381c84"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#a3db405dc4bb2b180afa548f1f4381c84">set_backup_ids_cached</a> ($restoreid, $itemname, $itemid, $extrarecord)</td></tr>
<tr class="memdesc:a3db405dc4bb2b180afa548f1f4381c84"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cache backup ids'.  <br /></td></tr>
<tr class="separator:a3db405dc4bb2b180afa548f1f4381c84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fcf80c9cdcb2a0cdcc40530d3c977e8"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d87/classrestore__dbops.html#a8fcf80c9cdcb2a0cdcc40530d3c977e8">update_backup_cached_record</a> ($record, $extrarecord, $key, $existingrecord=null)</td></tr>
<tr class="memdesc:a8fcf80c9cdcb2a0cdcc40530d3c977e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates existing backup record.  <br /></td></tr>
<tr class="separator:a8fcf80c9cdcb2a0cdcc40530d3c977e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Base abstract class for all the helper classes providing <a class="el" href="../../d1/dc8/class_d_b.html" title="The main &quot;DB&quot; class is simply a container class with some static methods for creating DB objects as w...">DB</a> operations. </p>
<p>TODO: Finish phpdocs </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a2b9325f5a4a59b86969cbeb30055679f" name="a2b9325f5a4a59b86969cbeb30055679f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b9325f5a4a59b86969cbeb30055679f">&#9670;&#160;</a></span>create_included_users()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::create_included_users </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$basepath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$restoreid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$userid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/df4/classcore_1_1progress_1_1base.html">core\progress\base</a>&#160;</td>
          <td class="paramname"><em>$progress</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Given one restoreid, create in <a class="el" href="../../d1/dc8/class_d_b.html" title="The main &quot;DB&quot; class is simply a container class with some static methods for creating DB objects as w...">DB</a> all the users present in backup_ids having newitemid = 0, as far as <a class="el" href="../../d1/d87/classrestore__dbops.html#a23f90410363b86d93eab6b60c0c1c69c" title="Check all the included users, deciding the action to perform for each one (mapping / creation) and re...">precheck_included_users()</a> have left them there ready to be created. </p>
<p>Also, annotate their newids once created for later reference.</p>
<p>This function will start and end a new progress section in the progress object.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$basepath</td><td>Base path of unzipped backup </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$restoreid</td><td>Restore ID </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userid</td><td>Default userid for files </td></tr>
    <tr><td class="paramtype"><a class="el" href="../../db/df4/classcore_1_1progress_1_1base.html">core::progress::base</a></td><td class="paramname">$progress</td><td>Object used for progress tracking </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac9e661703a938c2da4eb430b14f3bf95" name="ac9e661703a938c2da4eb430b14f3bf95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9e661703a938c2da4eb430b14f3bf95">&#9670;&#160;</a></span>create_new_course()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../d3/d6e/classmoodle__database.html">moodle_database</a> restore_dbops::create_new_course </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fullname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$shortname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$categoryid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Creates a skeleton record within the database using the passed parameters and returns the new course id. </p>
<p>$DB </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$fullname</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$shortname</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$categoryid</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td>The new course id </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a7d5b6f4831be62aa2cb3b9ca5ebb5711" name="a7d5b6f4831be62aa2cb3b9ca5ebb5711"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d5b6f4831be62aa2cb3b9ca5ebb5711">&#9670;&#160;</a></span>delete_course_content()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::delete_course_content </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$courseid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array&#160;</td>
          <td class="paramname"><em>$options</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Deletes all of the content associated with the given course (courseid) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$courseid</td><td></td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>True for success </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a90312d419e046123eafb81b7a63c8782" name="a90312d419e046123eafb81b7a63c8782"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90312d419e046123eafb81b7a63c8782">&#9670;&#160;</a></span>get_backup_ids_cached()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::get_backup_ids_cached </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$restoreid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$itemname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$itemid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return cached backup id's. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$restoreid</td><td>id of backup </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$itemname</td><td>name of the item </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$itemid</td><td>id of item </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>backup id's </td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000022">Todo:</a></b></dt><dd><a href="https://tracker.moodle.org/browse/MDL-25290" class="el">MDL-25290</a> replace static backupids* with MUC code </dd></dl>

</div>
</div>
<a id="af549b41e01ef84c0177c6e4861da0a7b" name="af549b41e01ef84c0177c6e4861da0a7b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af549b41e01ef84c0177c6e4861da0a7b">&#9670;&#160;</a></span>get_included_tasks()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::get_included_tasks </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$restoreid</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return one array containing all the tasks that have been included in the restore process. </p>
<p>Note that these tasks aren't built (they haven't steps nor ids data available) </p>

</div>
</div>
<a id="a9b00ab154feefe0be906dff3f0cf5e92" name="a9b00ab154feefe0be906dff3f0cf5e92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b00ab154feefe0be906dff3f0cf5e92">&#9670;&#160;</a></span>get_missing_file_result()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::get_missing_file_result </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns suitable entry to include in log when there is a missing file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass</td><td class="paramname">$file</td><td>File definition </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">stdClass</td><td>Log entry </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a949f85853ebbbabbcd7495396a1fc740" name="a949f85853ebbbabbcd7495396a1fc740"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a949f85853ebbbabbcd7495396a1fc740">&#9670;&#160;</a></span>load_inforef_to_tempids()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::load_inforef_to_tempids </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$restoreid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$inforeffile</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/df4/classcore_1_1progress_1_1base.html">core\progress\base</a>&#160;</td>
          <td class="paramname"><em>$progress</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Load one inforef.xml file to backup_ids table for future reference. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$restoreid</td><td>Restore id </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$inforeffile</td><td>File path </td></tr>
    <tr><td class="paramtype"><a class="el" href="../../db/df4/classcore_1_1progress_1_1base.html">core::progress::base</a></td><td class="paramname">$progress</td><td>Progress tracker </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="abf4bbe0473e45a70ff95fe8542faa633" name="abf4bbe0473e45a70ff95fe8542faa633"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf4bbe0473e45a70ff95fe8542faa633">&#9670;&#160;</a></span>load_users_to_tempids()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::load_users_to_tempids </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$restoreid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$usersfile</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/df4/classcore_1_1progress_1_1base.html">core\progress\base</a>&#160;</td>
          <td class="paramname"><em>$progress</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Load the needed users.xml file to backup_ids table for future reference. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$restoreid</td><td>Restore id </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$usersfile</td><td>File path </td></tr>
    <tr><td class="paramtype"><a class="el" href="../../db/df4/classcore_1_1progress_1_1base.html">core::progress::base</a></td><td class="paramname">$progress</td><td>Progress tracker </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a1fd3e17ef77aecd29911b1d129e2cd12" name="a1fd3e17ef77aecd29911b1d129e2cd12"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fd3e17ef77aecd29911b1d129e2cd12">&#9670;&#160;</a></span>precheck_categories_and_questions()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::precheck_categories_and_questions </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$restoreid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$courseid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$userid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$samesite</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check all the included categories and questions, deciding the action to perform for each one (mapping / creation) and returning one array of problems in case something is wrong. </p>
<p>There are some basic rules that the method below will always try to enforce:</p>
<p>Rule1: Targets will be, always, calculated for <em>whole</em> question banks (a.k.a. contexid source), so, given 2 question categories belonging to the same bank, their target bank will be always the same. If not, we can be incurring into "fragmentation", leading to random/cloze problems (qtypes having "child" questions).</p>
<p>Rule2: The 'moodle/question:managecategory' and 'moodle/question:add' capabilities will be checked before creating any category/question respectively and, if the cap is not allowed into upper contexts (system, coursecat)) but in lower ones (course), the <em>whole</em> question bank will be created there.</p>
<p>Rule3: Coursecat question banks not existing in the target site will be created as course (lower ctx) question banks, never as "guessed" coursecat question banks base on depth or so.</p>
<p>Rule4: System question banks will be created at system context if user has perms to do so. Else they will created as course (lower ctx) question banks (similary to rule3). In other words, course ctx if always a fallback for system and coursecat question banks.</p>
<p>Also, there are some notes to clarify the scope of this method:</p>
<p>Note1: This method won't create any question category nor question at all. It simply will calculate which actions (create/map) must be performed for each element and where, validating that all those actions are doable by the user executing the restore operation. Any problem found will be returned in the problems array, causing the restore process to stop with error.</p>
<p>Note2: To decide if one question bank (all its question categories and questions) is going to be remapped, then all the categories and questions must exist in the same target bank. If able to do so, missing qcats and qs will be created (rule2). But if, at the end, something is missing, the whole question bank will be recreated at course ctx (rule1), no matter if that duplicates some categories/questions.</p>
<p>Note3: We'll be using the newitemid column in the temp_ids table to store the action to be performed with each question category and question. newitemid = 0 means the qcat/q needs to be created and any other value means the qcat/q is mapped. Also, for qcats, parentitemid will contain the target context where the categories have to be created (but for module contexts where we'll keep the old one until the activity is created)</p>
<p>Note4: All these "actions" will be "executed" later by <a class="el" href="../../d0/d64/classrestore__create__categories__and__questions.html">restore_create_categories_and_questions</a> </p>

</div>
</div>
<a id="a3c59fc29c2c85b491241b8946f2cea9d" name="a3c59fc29c2c85b491241b8946f2cea9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c59fc29c2c85b491241b8946f2cea9d">&#9670;&#160;</a></span>precheck_included_roles()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::precheck_included_roles </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$restoreid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$courseid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$userid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$samesite</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$rolemappings</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Precheck the loaded roles, return empty array if everything is ok, and array with 'errors', 'warnings' elements (suitable to be used by restore_prechecks) with any problem found. </p>
<p>At the same time, store all the mapping into backup_ids_temp and also put the information into $rolemappings (controller-&gt;info), so it can be reworked later by post-precheck stages while at the same time accept modified info in the same object coming from UI </p>

</div>
</div>
<a id="a23f90410363b86d93eab6b60c0c1c69c" name="a23f90410363b86d93eab6b60c0c1c69c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23f90410363b86d93eab6b60c0c1c69c">&#9670;&#160;</a></span>precheck_included_users()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::precheck_included_users </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$restoreid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$courseid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$userid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$samesite</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/df4/classcore_1_1progress_1_1base.html">core\progress\base</a>&#160;</td>
          <td class="paramname"><em>$progress</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check all the included users, deciding the action to perform for each one (mapping / creation) and returning one array of problems in case something is wrong (lack of permissions, conficts) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$restoreid</td><td>Restore id </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$courseid</td><td>Course id </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userid</td><td>User id </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$samesite</td><td>True if restore is to same site </td></tr>
    <tr><td class="paramtype"><a class="el" href="../../db/df4/classcore_1_1progress_1_1base.html">core::progress::base</a></td><td class="paramname">$progress</td><td>Progress reporter </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a7c6a9b15e0be336cbb24735e2253609d" name="a7c6a9b15e0be336cbb24735e2253609d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c6a9b15e0be336cbb24735e2253609d">&#9670;&#160;</a></span>precheck_user()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::precheck_user </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$samesite</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$siteid</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Given one user object (from backup file), perform all the neccesary checks is order to decide how that user will be handled on restore. </p>
<p>Note the function requires $user-&gt;mnethostid to be already calculated so it's caller responsibility to set it</p>
<p>This function is used both by @restore_precheck_users() and @restore_create_users() to get consistent results in both places</p>
<p>It returns:</p><ul>
<li>one user object (from <a class="el" href="../../d1/dc8/class_d_b.html" title="The main &quot;DB&quot; class is simply a container class with some static methods for creating DB objects as w...">DB</a>), if match has been found and user will be remapped</li>
<li>boolean true if the user needs to be created</li>
<li>boolean false if some conflict happened and the user cannot be handled</li>
</ul>
<p>Each test is responsible for returning its results and interrupt execution. At the end, boolean true (user needs to be created) will be returned if no test has interrupted that.</p>
<p>Here it's the logic applied, keep it updated:</p>
<p>If restoring users from same site backup: 1A - Normal check: If match by id and username and mnethost =&gt; ok, return target user 1B - If restoring an 'anonymous' user (created via the 'Anonymize user information' option) try to find a match by username only =&gt; ok, return target user <a href="https://tracker.moodle.org/browse/MDL-31484" class="el">MDL-31484</a> 1C - Handle users deleted in <a class="el" href="../../d1/dc8/class_d_b.html" title="The main &quot;DB&quot; class is simply a container class with some static methods for creating DB objects as w...">DB</a> and "alive" in backup file: If match by id and mnethost and user is deleted in <a class="el" href="../../d1/dc8/class_d_b.html" title="The main &quot;DB&quot; class is simply a container class with some static methods for creating DB objects as w...">DB</a> and (match by username LIKE 'backup_email.' or by non empty email = md5(username)) =&gt; ok, return target user 1D - Handle users deleted in backup file and "alive" in <a class="el" href="../../d1/dc8/class_d_b.html" title="The main &quot;DB&quot; class is simply a container class with some static methods for creating DB objects as w...">DB</a>: If match by id and mnethost and user is deleted in backup file and match by email = email_without_time(backup_email) =&gt; ok, return target user 1E - Conflict: If match by username and mnethost and doesn't match by id =&gt; conflict, return false 1F - None of the above, return true =&gt; User needs to be created</p>
<p>if restoring from another site backup (cannot match by id here, replace it by email/firstaccess combination): 2A - Normal check: 2A1 - If match by username and mnethost and (email or non-zero firstaccess) =&gt; ok, return target user 2A2 - Exceptional handling (<a href="https://tracker.moodle.org/browse/MDL-21912" class="el">MDL-21912</a>): Match "admin" username. Then, if import_general_duplicate_admin_allowed is enabled, attempt to map the admin user to the user 'admin_[oldsiteid]' if it exists. If not, the user 'admin_[oldsiteid]' will be created in precheck_included users 2B - Handle users deleted in <a class="el" href="../../d1/dc8/class_d_b.html" title="The main &quot;DB&quot; class is simply a container class with some static methods for creating DB objects as w...">DB</a> and "alive" in backup file: 2B1 - If match by mnethost and user is deleted in <a class="el" href="../../d1/dc8/class_d_b.html" title="The main &quot;DB&quot; class is simply a container class with some static methods for creating DB objects as w...">DB</a> and not empty email = md5(username) and (username LIKE 'backup_email.' or non-zero firstaccess) =&gt; ok, return target user 2B2 - If match by mnethost and user is deleted in <a class="el" href="../../d1/dc8/class_d_b.html" title="The main &quot;DB&quot; class is simply a container class with some static methods for creating DB objects as w...">DB</a> and username LIKE 'backup_email.' and non-zero firstaccess) =&gt; ok, return target user (to cover situations were md5(username) wasn't implemented on delete we requiere both) 2C - Handle users deleted in backup file and "alive" in <a class="el" href="../../d1/dc8/class_d_b.html" title="The main &quot;DB&quot; class is simply a container class with some static methods for creating DB objects as w...">DB</a>: If match mnethost and user is deleted in backup file and by email = email_without_time(backup_email) and non-zero firstaccess=&gt; ok, return target user 2D - Conflict: If match by username and mnethost and not by (email or non-zero firstaccess) =&gt; conflict, return false 2E - None of the above, return true =&gt; User needs to be created</p>
<p>Note: for <a class="el" href="../../d1/dc8/class_d_b.html" title="The main &quot;DB&quot; class is simply a container class with some static methods for creating DB objects as w...">DB</a> deleted users email is stored in username field, hence we are looking there for emails. See <a class="el" href="../../d0/de1/group__core.html#gab90974b737cf96d0839712fc93632310" title="Marks user deleted in internal user database and notifies the auth plugin.">delete_user()</a> Note: for <a class="el" href="../../d1/dc8/class_d_b.html" title="The main &quot;DB&quot; class is simply a container class with some static methods for creating DB objects as w...">DB</a> deleted users md5(username) is stored <em>sometimes</em> in the email field, hence we are looking there for usernames if not empty. See <a class="el" href="../../d0/de1/group__core.html#gab90974b737cf96d0839712fc93632310" title="Marks user deleted in internal user database and notifies the auth plugin.">delete_user()</a> </p>

</div>
</div>
<a id="a44033084ef1a15a304a808f26c80f65a" name="a44033084ef1a15a304a808f26c80f65a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44033084ef1a15a304a808f26c80f65a">&#9670;&#160;</a></span>prechek_precheck_qbanks_by_level()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::prechek_precheck_qbanks_by_level </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$restoreid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$courseid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$userid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$samesite</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contextlevel</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This function will process all the question banks present in restore at some contextlevel (from CONTEXT_SYSTEM to CONTEXT_MODULE), finding the target contexts where each bank will be restored and returning warnings/errors as needed. </p>
<p>Some contextlevels (system, coursecat), will delegate process to course level if any problem is found (lack of permissions, non-matching target context...). Other contextlevels (course, module) will cause return error if some problem is found.</p>
<p>At the end, if no errors were found, all the categories in backup_temp_ids will be pointing (parentitemid) to the target context where they must be created later in the restore process.</p>
<p>Note: at the time these prechecks are executed, activities haven't been created yet so, for CONTEXT_MODULE banks, we keep the old contextid in the parentitemid field. Once the activity (and its context) has been created, we'll update that context in the required qcats</p>
<p>Caller <a class="el" href="../../d1/d87/classrestore__dbops.html#a1fd3e17ef77aecd29911b1d129e2cd12">precheck_categories_and_questions</a> will, simply, execute this function for all the contextlevels, acting as a simple controller of warnings and errors.</p>
<p>The function returns 2 arrays, one containing errors and another containing warnings. Both empty if no errors/warnings are found.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$restoreid</td><td>The restore ID </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$courseid</td><td>The ID of the course </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userid</td><td>The id of the user doing the restore </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$samesite</td><td>True if restore is to same site </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$contextlevel</td><td>(CONTEXT_SYSTEM, etc.) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>A separate list of all error and warnings detected </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ae512535c95bd2497d5c0886edb5568d9" name="ae512535c95bd2497d5c0886edb5568d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae512535c95bd2497d5c0886edb5568d9">&#9670;&#160;</a></span>process_categories_and_questions()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::process_categories_and_questions </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$restoreid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$courseid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$userid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$samesite</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Process the needed question categories and questions to check all them, deciding about the action to perform (create/map) and target. </p>
<p>Just wrap over <a class="el" href="../../d1/d87/classrestore__dbops.html#a1fd3e17ef77aecd29911b1d129e2cd12" title="Check all the included categories and questions, deciding the action to perform for each one (mapping...">precheck_categories_and_questions()</a>, returning exception if any problem is found </p>

</div>
</div>
<a id="a0ec907745ce428db1948bec2d5996af9" name="a0ec907745ce428db1948bec2d5996af9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ec907745ce428db1948bec2d5996af9">&#9670;&#160;</a></span>process_included_roles()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::process_included_roles </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$restoreid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$courseid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$userid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$samesite</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$rolemappings</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Process the loaded roles, looking for their best mapping or skipping Any error will cause exception. </p>
<p>Note this is one wrapper over precheck_included_roles, that contains all the logic, but returns errors/warnings instead and is executed as part of the restore prechecks </p>

</div>
</div>
<a id="ab95ed4963c51cd1ce2ac64f0a1a7be7d" name="ab95ed4963c51cd1ce2ac64f0a1a7be7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab95ed4963c51cd1ce2ac64f0a1a7be7d">&#9670;&#160;</a></span>process_included_users()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::process_included_users </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$restoreid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$courseid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$userid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$samesite</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/df4/classcore_1_1progress_1_1base.html">core\progress\base</a>&#160;</td>
          <td class="paramname"><em>$progress</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Process the needed users in order to decide which action to perform with them (create/map) </p>
<p>Just wrap over <a class="el" href="../../d1/d87/classrestore__dbops.html#a23f90410363b86d93eab6b60c0c1c69c" title="Check all the included users, deciding the action to perform for each one (mapping / creation) and re...">precheck_included_users()</a>, returning exception if any problem is found</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$restoreid</td><td>Restore id </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$courseid</td><td>Course id </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userid</td><td>User id </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$samesite</td><td>True if restore is to same site </td></tr>
    <tr><td class="paramtype"><a class="el" href="../../db/df4/classcore_1_1progress_1_1base.html">core::progress::base</a></td><td class="paramname">$progress</td><td>Optional progress tracker </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ad29218c85473f5dea778381a2dbf752a" name="ad29218c85473f5dea778381a2dbf752a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad29218c85473f5dea778381a2dbf752a">&#9670;&#160;</a></span>reset_backup_ids_cached()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::reset_backup_ids_cached </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reset the ids caches completely. </p>
<p>Any destructive operation (partial delete, truncate, drop or recreate) performed with the backup_ids table must cause the backup_ids caches to be invalidated by calling this method. See <a href="https://tracker.moodle.org/browse/MDL-33630" class="el">MDL-33630</a>.</p>
<p>Note that right now, the only operation of that type is the recreation (drop &amp; restore) of the table that may happen once the prechecks have ended. All the rest of operations are always routed via <a class="el" href="../../#a664593a34d479e20680a1df379b023c2">set_backup_ids_record()</a>, 1 by 1, keeping the caches on sync.</p>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000024">Todo:</a></b></dt><dd><a href="https://tracker.moodle.org/browse/MDL-25290" class="el">MDL-25290</a> static should be replaced with MUC code. </dd></dl>

</div>
</div>
<a id="ae3f17ad07c90055e6473b0ca92a3b1ee" name="ae3f17ad07c90055e6473b0ca92a3b1ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3f17ad07c90055e6473b0ca92a3b1ee">&#9670;&#160;</a></span>restore_get_question_categories()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::restore_get_question_categories </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$restoreid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contextid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contextlevel</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return one array of question_category records for a given restore operation and one restore context (question bank) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$restoreid</td><td>Unique identifier of the restore operation being performed. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$contextid</td><td>Context id we want question categories to be returned. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$contextlevel</td><td>Context level we want to restrict the returned categories. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>Question categories for the given context id and level. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a88f8046313887bac3cccd1768f1a6319" name="a88f8046313887bac3cccd1768f1a6319"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88f8046313887bac3cccd1768f1a6319">&#9670;&#160;</a></span>send_files_to_pool()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::send_files_to_pool </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$basepath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$restoreid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$component</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filearea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$oldcontextid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$dfltuserid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$itemname</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$olditemid</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$forcenewcontextid</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$skipparentitemidctxmatch</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/df4/classcore_1_1progress_1_1base.html">core\progress\base</a>&#160;</td>
          <td class="paramname"><em>$progress</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Given one component/filearea/context and optionally one source itemname to match itemids put the corresponding files in the pool. </p>
<p>If you specify a progress reporter, it will get called once per file with indeterminate progress.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$basepath</td><td>the full path to the root of unzipped backup file </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$restoreid</td><td>the restore job's identification </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$component</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filearea</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$oldcontextid</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$dfltuserid</td><td>default $file-&gt;user if the old one can't be mapped </td></tr>
    <tr><td class="paramtype">string&#160;|&#160;null</td><td class="paramname">$itemname</td><td></td></tr>
    <tr><td class="paramtype">int&#160;|&#160;null</td><td class="paramname">$olditemid</td><td></td></tr>
    <tr><td class="paramtype">int&#160;|&#160;null</td><td class="paramname">$forcenewcontextid</td><td>explicit value for the new contextid (skip mapping) </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$skipparentitemidctxmatch</td><td></td></tr>
    <tr><td class="paramtype"><a class="el" href="../../db/df4/classcore_1_1progress_1_1base.html">core::progress::base</a></td><td class="paramname">$progress</td><td>Optional progress reporter </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>of result object </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a3db405dc4bb2b180afa548f1f4381c84" name="a3db405dc4bb2b180afa548f1f4381c84"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3db405dc4bb2b180afa548f1f4381c84">&#9670;&#160;</a></span>set_backup_ids_cached()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::set_backup_ids_cached </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$restoreid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$itemname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$itemid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$extrarecord</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Cache backup ids'. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$restoreid</td><td>id of backup </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$itemname</td><td>name of the item </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$itemid</td><td>id of item </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$extrarecord</td><td>extra record which needs to be updated </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">void</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000023">Todo:</a></b></dt><dd><a href="https://tracker.moodle.org/browse/MDL-25290" class="el">MDL-25290</a> replace static BACKUP_IDS_* with MUC code </dd></dl>

</div>
</div>
<a id="a8fcf80c9cdcb2a0cdcc40530d3c977e8" name="a8fcf80c9cdcb2a0cdcc40530d3c977e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8fcf80c9cdcb2a0cdcc40530d3c977e8">&#9670;&#160;</a></span>update_backup_cached_record()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static restore_dbops::update_backup_cached_record </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$record</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$extrarecord</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$existingrecord</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Updates existing backup record. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$record</td><td>record which needs to be updated </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$extrarecord</td><td>extra record which needs to be updated </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$key</td><td>unique key which is used to identify cached record </td></tr>
    <tr><td class="paramtype">stdClass</td><td class="paramname">$existingrecord</td><td>(optional) existing record </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>backup/util/dbops/restore_dbops.class.php</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 13 2023 02:34:16 for Moodle PHP Documentation by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
