<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Moodle PHP Documentation: file_storage Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Moodle PHP Documentation"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Moodle-Logo-ReversedWhite_RGB.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Moodle PHP Documentation<span id="projectnumber">&#160;3.11</span>
   </div>
   <div id="projectbrief">Moodle 3.11.17+ (Build: 20231027) (f4877790f9)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.php','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="../../d8/d60/classfile__storage-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">file_storage Class Reference<div class="ingroups"><a class="el" href="../../d5/d09/group__core__files.html">core_files</a></div></div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ac408dfc9ba98848efe560d5b3bb89a76" id="r_ac408dfc9ba98848efe560d5b3bb89a76"><td class="memItemLeft" align="right" valign="top"><a id="ac408dfc9ba98848efe560d5b3bb89a76" name="ac408dfc9ba98848efe560d5b3bb89a76"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>__construct</b> ()</td></tr>
<tr class="memdesc:ac408dfc9ba98848efe560d5b3bb89a76"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor - do not use directly use <a class="el" href="../../d0/de1/group__core.html#ga656863109b34d1bd55687a9f5e7d920e">get_file_storage()</a> call instead. <br /></td></tr>
<tr class="separator:ac408dfc9ba98848efe560d5b3bb89a76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0026bbe75557006ca922deff2af2b76e" id="r_a0026bbe75557006ca922deff2af2b76e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a0026bbe75557006ca922deff2af2b76e">add_file_to_pool</a> ($pathname, $contenthash=null, $newrecord=null)</td></tr>
<tr class="memdesc:a0026bbe75557006ca922deff2af2b76e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add file content to sha1 pool.  <br /></td></tr>
<tr class="separator:a0026bbe75557006ca922deff2af2b76e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef6751bccfe15c2c8d79640c3b0fa498" id="r_aef6751bccfe15c2c8d79640c3b0fa498"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#aef6751bccfe15c2c8d79640c3b0fa498">add_string_to_pool</a> ($content, $newrecord=null)</td></tr>
<tr class="memdesc:aef6751bccfe15c2c8d79640c3b0fa498"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add string content to sha1 pool.  <br /></td></tr>
<tr class="separator:aef6751bccfe15c2c8d79640c3b0fa498"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3654090827bf595f24abb3e8a83f02fc" id="r_a3654090827bf595f24abb3e8a83f02fc"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a3654090827bf595f24abb3e8a83f02fc">content_exists</a> ($contenthash)</td></tr>
<tr class="memdesc:a3654090827bf595f24abb3e8a83f02fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Content exists.  <br /></td></tr>
<tr class="separator:a3654090827bf595f24abb3e8a83f02fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae67ad83823a0eddf8bf6f2dc5191bc44" id="r_ae67ad83823a0eddf8bf6f2dc5191bc44"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#ae67ad83823a0eddf8bf6f2dc5191bc44">convert_image</a> ($filerecord, $fid, $newwidth=null, $newheight=null, $keepaspectratio=true, $quality=null)</td></tr>
<tr class="memdesc:ae67ad83823a0eddf8bf6f2dc5191bc44"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates new image file from existing.  <br /></td></tr>
<tr class="separator:ae67ad83823a0eddf8bf6f2dc5191bc44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4126b4780ec9a34b1bf45d46c96ea57f" id="r_a4126b4780ec9a34b1bf45d46c96ea57f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a4126b4780ec9a34b1bf45d46c96ea57f">create_directory</a> ($contextid, $component, $filearea, $itemid, $filepath, $userid=null)</td></tr>
<tr class="memdesc:a4126b4780ec9a34b1bf45d46c96ea57f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Recursively creates directory.  <br /></td></tr>
<tr class="separator:a4126b4780ec9a34b1bf45d46c96ea57f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c069fbadc065de61e20cd4941cba04f" id="r_a6c069fbadc065de61e20cd4941cba04f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a6c069fbadc065de61e20cd4941cba04f">create_file_from_pathname</a> ($filerecord, $pathname)</td></tr>
<tr class="memdesc:a6c069fbadc065de61e20cd4941cba04f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add new local file.  <br /></td></tr>
<tr class="separator:a6c069fbadc065de61e20cd4941cba04f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c73955832528e27618244f864bbe254" id="r_a7c73955832528e27618244f864bbe254"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a7c73955832528e27618244f864bbe254">create_file_from_reference</a> ($filerecord, $repositoryid, $reference, $options=array())</td></tr>
<tr class="memdesc:a7c73955832528e27618244f864bbe254"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new alias/shortcut file from file reference information.  <br /></td></tr>
<tr class="separator:a7c73955832528e27618244f864bbe254"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9275f276950e9820d34b1a7cd2235708" id="r_a9275f276950e9820d34b1a7cd2235708"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a9275f276950e9820d34b1a7cd2235708">create_file_from_storedfile</a> ($filerecord, $fileorid)</td></tr>
<tr class="memdesc:a9275f276950e9820d34b1a7cd2235708"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add new local file based on existing local file.  <br /></td></tr>
<tr class="separator:a9275f276950e9820d34b1a7cd2235708"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49a9328770527260ab28a683b15d007a" id="r_a49a9328770527260ab28a683b15d007a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a49a9328770527260ab28a683b15d007a">create_file_from_string</a> ($filerecord, $content)</td></tr>
<tr class="memdesc:a49a9328770527260ab28a683b15d007a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add new local file.  <br /></td></tr>
<tr class="separator:a49a9328770527260ab28a683b15d007a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9cd50a05d0314e19156504575d7878b" id="r_af9cd50a05d0314e19156504575d7878b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#af9cd50a05d0314e19156504575d7878b">create_file_from_url</a> ($filerecord, $url, array $options=null, $usetempfile=false)</td></tr>
<tr class="memdesc:af9cd50a05d0314e19156504575d7878b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add new local file.  <br /></td></tr>
<tr class="separator:af9cd50a05d0314e19156504575d7878b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a325281aaf52edf825c382656462c9197" id="r_a325281aaf52edf825c382656462c9197"><td class="memItemLeft" align="right" valign="top"><a id="a325281aaf52edf825c382656462c9197" name="a325281aaf52edf825c382656462c9197"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>cron</b> ()</td></tr>
<tr class="memdesc:a325281aaf52edf825c382656462c9197"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cron cleanup job. <br /></td></tr>
<tr class="separator:a325281aaf52edf825c382656462c9197"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f2e8702ddbba81e134e5e328c927e41" id="r_a6f2e8702ddbba81e134e5e328c927e41"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a6f2e8702ddbba81e134e5e328c927e41">delete_area_files</a> ($contextid, $component=false, $filearea=false, $itemid=false)</td></tr>
<tr class="memdesc:a6f2e8702ddbba81e134e5e328c927e41"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delete all area files (optionally limited by itemid).  <br /></td></tr>
<tr class="separator:a6f2e8702ddbba81e134e5e328c927e41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6eed3316c1a8f2e7ef6537a176d83a39" id="r_a6eed3316c1a8f2e7ef6537a176d83a39"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a6eed3316c1a8f2e7ef6537a176d83a39">delete_area_files_select</a> ($contextid, $component, $filearea, $itemidstest, array $params=null)</td></tr>
<tr class="memdesc:a6eed3316c1a8f2e7ef6537a176d83a39"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delete all the files from certain areas where itemid is limited by an arbitrary bit of SQL.  <br /></td></tr>
<tr class="separator:a6eed3316c1a8f2e7ef6537a176d83a39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4725ec33fb4f420e0207c140406ca028" id="r_a4725ec33fb4f420e0207c140406ca028"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a4725ec33fb4f420e0207c140406ca028">delete_component_files</a> ($component)</td></tr>
<tr class="memdesc:a4725ec33fb4f420e0207c140406ca028"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delete all files associated with the given component.  <br /></td></tr>
<tr class="separator:a4725ec33fb4f420e0207c140406ca028"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ef2e0a68700490d799397e085cf60d2" id="r_a5ef2e0a68700490d799397e085cf60d2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a5ef2e0a68700490d799397e085cf60d2">file_exists</a> ($contextid, $component, $filearea, $itemid, $filepath, $filename)</td></tr>
<tr class="memdesc:a5ef2e0a68700490d799397e085cf60d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Does this file exist?  <br /></td></tr>
<tr class="separator:a5ef2e0a68700490d799397e085cf60d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad693fe9f5fc095a8f7f6991d45c6279e" id="r_ad693fe9f5fc095a8f7f6991d45c6279e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#ad693fe9f5fc095a8f7f6991d45c6279e">file_exists_by_hash</a> ($pathnamehash)</td></tr>
<tr class="memdesc:ad693fe9f5fc095a8f7f6991d45c6279e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether or not the file exist.  <br /></td></tr>
<tr class="separator:ad693fe9f5fc095a8f7f6991d45c6279e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf11ed9a82d7e1771dbfdc6b4f3a5f96" id="r_aaf11ed9a82d7e1771dbfdc6b4f3a5f96"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#aaf11ed9a82d7e1771dbfdc6b4f3a5f96">get_area_files</a> ($contextid, $component, $filearea, $itemid=false, $<a class="el" href="../../dc/d71/group___imap___client.html#ga4bd31bcedb7b4943aac2da78d0d84afe">sort</a>=&quot;itemid, filepath, filename&quot;, $includedirs=true, $updatedsince=0, $limitfrom=0, $limitnum=0)</td></tr>
<tr class="memdesc:aaf11ed9a82d7e1771dbfdc6b4f3a5f96"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns all area files (optionally limited by itemid)  <br /></td></tr>
<tr class="separator:aaf11ed9a82d7e1771dbfdc6b4f3a5f96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1747f21ff461d428d2268ca711739725" id="r_a1747f21ff461d428d2268ca711739725"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a1747f21ff461d428d2268ca711739725">get_area_tree</a> ($contextid, $component, $filearea, $itemid)</td></tr>
<tr class="memdesc:a1747f21ff461d428d2268ca711739725"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns array based tree structure of area files.  <br /></td></tr>
<tr class="separator:a1747f21ff461d428d2268ca711739725"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a933e57fa5324fc316ba76e72d4e43183" id="r_a933e57fa5324fc316ba76e72d4e43183"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a933e57fa5324fc316ba76e72d4e43183">get_converted_document</a> (<a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> $file, $format, $forcerefresh=false)</td></tr>
<tr class="memdesc:a933e57fa5324fc316ba76e72d4e43183"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get converted document.  <br /></td></tr>
<tr class="separator:a933e57fa5324fc316ba76e72d4e43183"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a1dc9e0e91cb61f8fb8c0cee2a4471e" id="r_a4a1dc9e0e91cb61f8fb8c0cee2a4471e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a4a1dc9e0e91cb61f8fb8c0cee2a4471e">get_directory_files</a> ($contextid, $component, $filearea, $itemid, $filepath, $recursive=false, $includedirs=true, $<a class="el" href="../../dc/d71/group___imap___client.html#ga4bd31bcedb7b4943aac2da78d0d84afe">sort</a>=&quot;filepath, filename&quot;)</td></tr>
<tr class="memdesc:a4a1dc9e0e91cb61f8fb8c0cee2a4471e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns all files and optionally directories.  <br /></td></tr>
<tr class="separator:a4a1dc9e0e91cb61f8fb8c0cee2a4471e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6643684a1236c2f8ad128f454944b6c0" id="r_a6643684a1236c2f8ad128f454944b6c0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a6643684a1236c2f8ad128f454944b6c0">get_external_files</a> ($repositoryid, $<a class="el" href="../../dc/d71/group___imap___client.html#ga4bd31bcedb7b4943aac2da78d0d84afe">sort</a>='')</td></tr>
<tr class="memdesc:a6643684a1236c2f8ad128f454944b6c0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns all files belonging to given repository.  <br /></td></tr>
<tr class="separator:a6643684a1236c2f8ad128f454944b6c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7ae000f33b92cb34482303cbce552c4" id="r_ac7ae000f33b92cb34482303cbce552c4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#ac7ae000f33b92cb34482303cbce552c4">get_file</a> ($contextid, $component, $filearea, $itemid, $filepath, $filename)</td></tr>
<tr class="memdesc:ac7ae000f33b92cb34482303cbce552c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fetch locally stored file.  <br /></td></tr>
<tr class="separator:ac7ae000f33b92cb34482303cbce552c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef265ef7ad4760ef4365b6aa9c73c466" id="r_aef265ef7ad4760ef4365b6aa9c73c466"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#aef265ef7ad4760ef4365b6aa9c73c466">get_file_by_hash</a> ($pathnamehash)</td></tr>
<tr class="memdesc:aef265ef7ad4760ef4365b6aa9c73c466"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fetch file using local file full pathname hash.  <br /></td></tr>
<tr class="separator:aef265ef7ad4760ef4365b6aa9c73c466"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc0fdfdf216e51344b64f19869f3a9b8" id="r_adc0fdfdf216e51344b64f19869f3a9b8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#adc0fdfdf216e51344b64f19869f3a9b8">get_file_by_id</a> ($fileid)</td></tr>
<tr class="memdesc:adc0fdfdf216e51344b64f19869f3a9b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fetch file using local file id.  <br /></td></tr>
<tr class="separator:adc0fdfdf216e51344b64f19869f3a9b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa05647c5ed68ff7f5ec0b7ea434960af" id="r_aa05647c5ed68ff7f5ec0b7ea434960af"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#aa05647c5ed68ff7f5ec0b7ea434960af">get_file_instance</a> (stdClass $filerecord)</td></tr>
<tr class="memdesc:aa05647c5ed68ff7f5ec0b7ea434960af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create instance of file class from database record.  <br /></td></tr>
<tr class="separator:aa05647c5ed68ff7f5ec0b7ea434960af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2df31efb57e898498a490bf04d0aff51" id="r_a2df31efb57e898498a490bf04d0aff51"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a2df31efb57e898498a490bf04d0aff51">get_file_preview</a> (<a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> $file, $mode)</td></tr>
<tr class="memdesc:a2df31efb57e898498a490bf04d0aff51"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns an image file that represent the given stored file as a preview.  <br /></td></tr>
<tr class="separator:a2df31efb57e898498a490bf04d0aff51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a00b81cd7da91b786c266a7521848a2" id="r_a5a00b81cd7da91b786c266a7521848a2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a5a00b81cd7da91b786c266a7521848a2">get_file_system</a> ()</td></tr>
<tr class="memdesc:a5a00b81cd7da91b786c266a7521848a2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the file system instance.  <br /></td></tr>
<tr class="separator:a5a00b81cd7da91b786c266a7521848a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5e64700148cc3751592934c060a34b5" id="r_ac5e64700148cc3751592934c060a34b5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#ac5e64700148cc3751592934c060a34b5">get_references_by_storedfile</a> (<a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> $storedfile)</td></tr>
<tr class="memdesc:ac5e64700148cc3751592934c060a34b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns all aliases that link to the given <a class="el" href="../../d0/d00/classstored__file.html">stored_file</a>.  <br /></td></tr>
<tr class="separator:ac5e64700148cc3751592934c060a34b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad599580b5f192a86f4d6b627a21e5aa9" id="r_ad599580b5f192a86f4d6b627a21e5aa9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#ad599580b5f192a86f4d6b627a21e5aa9">get_references_count_by_storedfile</a> (<a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> $storedfile)</td></tr>
<tr class="memdesc:ad599580b5f192a86f4d6b627a21e5aa9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the number of aliases that link to the given <a class="el" href="../../d0/d00/classstored__file.html">stored_file</a>.  <br /></td></tr>
<tr class="separator:ad599580b5f192a86f4d6b627a21e5aa9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ce0acb9dcbbcf980b6f7ca19f60fd4a" id="r_a1ce0acb9dcbbcf980b6f7ca19f60fd4a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a1ce0acb9dcbbcf980b6f7ca19f60fd4a">get_unused_dirname</a> ($contextid, $component, $filearea, $itemid, $suggestedpath)</td></tr>
<tr class="memdesc:a1ce0acb9dcbbcf980b6f7ca19f60fd4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return an available directory name.  <br /></td></tr>
<tr class="separator:a1ce0acb9dcbbcf980b6f7ca19f60fd4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97c81e35ed4968f3284edb734372fcfa" id="r_a97c81e35ed4968f3284edb734372fcfa"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a97c81e35ed4968f3284edb734372fcfa">get_unused_filename</a> ($contextid, $component, $filearea, $itemid, $filepath, $filename)</td></tr>
<tr class="memdesc:a97c81e35ed4968f3284edb734372fcfa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return an available file name.  <br /></td></tr>
<tr class="separator:a97c81e35ed4968f3284edb734372fcfa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad26cf68902db0683e1175cc32b106ef9" id="r_ad26cf68902db0683e1175cc32b106ef9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#ad26cf68902db0683e1175cc32b106ef9">get_user_draft_items</a> (int $userid, int $updatedsince=0, int $lastnum=0)</td></tr>
<tr class="memdesc:ad26cf68902db0683e1175cc32b106ef9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the file area item ids and their updatetime for a user's draft uploads, sorted by updatetime DESC.  <br /></td></tr>
<tr class="separator:ad26cf68902db0683e1175cc32b106ef9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0591bec4e68b964ef7f5f7d26758226a" id="r_a0591bec4e68b964ef7f5f7d26758226a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a0591bec4e68b964ef7f5f7d26758226a">import_external_file</a> (<a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> $storedfile, $maxbytes=0)</td></tr>
<tr class="memdesc:a0591bec4e68b964ef7f5f7d26758226a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert file alias to local file.  <br /></td></tr>
<tr class="separator:a0591bec4e68b964ef7f5f7d26758226a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b5eaf0936f8d2cf78c06dffaeca5323" id="r_a4b5eaf0936f8d2cf78c06dffaeca5323"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a4b5eaf0936f8d2cf78c06dffaeca5323">is_area_empty</a> ($contextid, $component, $filearea, $itemid=false, $ignoredirs=true)</td></tr>
<tr class="memdesc:a4b5eaf0936f8d2cf78c06dffaeca5323"><td class="mdescLeft">&#160;</td><td class="mdescRight">Are there any files (or directories)  <br /></td></tr>
<tr class="separator:a4b5eaf0936f8d2cf78c06dffaeca5323"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeeb9ea6ece4c02ebd3bdc61126dcf355" id="r_aeeb9ea6ece4c02ebd3bdc61126dcf355"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#aeeb9ea6ece4c02ebd3bdc61126dcf355">move_area_files_to_new_context</a> ($oldcontextid, $newcontextid, $component, $filearea, $itemid=false)</td></tr>
<tr class="memdesc:aeeb9ea6ece4c02ebd3bdc61126dcf355"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move all the files in a file area from one context to another.  <br /></td></tr>
<tr class="separator:aeeb9ea6ece4c02ebd3bdc61126dcf355"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af55999ceba6e30fb8b84cbd65d97348d" id="r_af55999ceba6e30fb8b84cbd65d97348d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#af55999ceba6e30fb8b84cbd65d97348d">search_references</a> ($reference)</td></tr>
<tr class="memdesc:af55999ceba6e30fb8b84cbd65d97348d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns all aliases that refer to some <a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> via the given reference.  <br /></td></tr>
<tr class="separator:af55999ceba6e30fb8b84cbd65d97348d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afefbf8f6d4c1f3e8ed6597ff78388ad9" id="r_afefbf8f6d4c1f3e8ed6597ff78388ad9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#afefbf8f6d4c1f3e8ed6597ff78388ad9">search_references_count</a> ($reference)</td></tr>
<tr class="memdesc:afefbf8f6d4c1f3e8ed6597ff78388ad9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the number of aliases that refer to some <a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> via the given reference.  <br /></td></tr>
<tr class="separator:afefbf8f6d4c1f3e8ed6597ff78388ad9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03c51dde641a58299f0b43282490ea2e" id="r_a03c51dde641a58299f0b43282490ea2e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a03c51dde641a58299f0b43282490ea2e">search_server_files</a> ($<a class="el" href="../../dc/d71/group___imap___client.html#gae0ccb7bceda061e460576520b09aa443">query</a>, $from=0, $limit=20, $count=false)</td></tr>
<tr class="memdesc:a03c51dde641a58299f0b43282490ea2e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Search through the server files.  <br /></td></tr>
<tr class="separator:a03c51dde641a58299f0b43282490ea2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a674b8abdc52ed6d010a99c40e8d37464" id="r_a674b8abdc52ed6d010a99c40e8d37464"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a674b8abdc52ed6d010a99c40e8d37464">setup_file_system</a> ()</td></tr>
<tr class="memdesc:a674b8abdc52ed6d010a99c40e8d37464"><td class="mdescLeft">&#160;</td><td class="mdescRight">Complete setup procedure for the <a class="el" href="../../df/d66/classfile__system.html">file_system</a> component.  <br /></td></tr>
<tr class="separator:a674b8abdc52ed6d010a99c40e8d37464"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a746b11c0a6e6f6a3d1a0a2ac8938df2c" id="r_a746b11c0a6e6f6a3d1a0a2ac8938df2c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a746b11c0a6e6f6a3d1a0a2ac8938df2c">supports_xsendfile</a> ()</td></tr>
<tr class="memdesc:a746b11c0a6e6f6a3d1a0a2ac8938df2c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if filesystem is configured to support xsendfile.  <br /></td></tr>
<tr class="separator:a746b11c0a6e6f6a3d1a0a2ac8938df2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3053fc919b5b3bf68b2f8208c2324ed0" id="r_a3053fc919b5b3bf68b2f8208c2324ed0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a3053fc919b5b3bf68b2f8208c2324ed0">synchronise_stored_file_from_file</a> (<a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> $file, $path, $filerecord)</td></tr>
<tr class="memdesc:a3053fc919b5b3bf68b2f8208c2324ed0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Synchronise stored file from file.  <br /></td></tr>
<tr class="separator:a3053fc919b5b3bf68b2f8208c2324ed0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a5e5817a6dc917d86eb865191b8e201" id="r_a7a5e5817a6dc917d86eb865191b8e201"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a7a5e5817a6dc917d86eb865191b8e201">synchronise_stored_file_from_string</a> (<a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> $file, $content, $filerecord)</td></tr>
<tr class="memdesc:a7a5e5817a6dc917d86eb865191b8e201"><td class="mdescLeft">&#160;</td><td class="mdescRight">Synchronise stored file from string.  <br /></td></tr>
<tr class="separator:a7a5e5817a6dc917d86eb865191b8e201"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad437a46e306726919caca60f1aa4d3d7" id="r_ad437a46e306726919caca60f1aa4d3d7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#ad437a46e306726919caca60f1aa4d3d7">try_content_recovery</a> ($file)</td></tr>
<tr class="memdesc:ad437a46e306726919caca60f1aa4d3d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tries to recover missing content of file from trash.  <br /></td></tr>
<tr class="separator:ad437a46e306726919caca60f1aa4d3d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b85dd60109390732b80d81123c68306" id="r_a0b85dd60109390732b80d81123c68306"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a0b85dd60109390732b80d81123c68306">update_references</a> ($referencefileid, $lastsync, $lifetime, $contenthash, $filesize, $<a class="el" href="../../dc/d71/group___imap___client.html#ga5bf8518b59eeb46c71681066d12016bd">status</a>, $timemodified=null)</td></tr>
<tr class="memdesc:a0b85dd60109390732b80d81123c68306"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates a reference to the external resource and all files that use it.  <br /></td></tr>
<tr class="separator:a0b85dd60109390732b80d81123c68306"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee81e1e5f840d32e5bf5a6b87cfa41f0" id="r_aee81e1e5f840d32e5bf5a6b87cfa41f0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#aee81e1e5f840d32e5bf5a6b87cfa41f0">update_references_to_storedfile</a> (<a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> $storedfile)</td></tr>
<tr class="memdesc:aee81e1e5f840d32e5bf5a6b87cfa41f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates all files that are referencing this file with the new contenthash and filesize.  <br /></td></tr>
<tr class="separator:aee81e1e5f840d32e5bf5a6b87cfa41f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf87f282b50fc42ee5cad7f2a4d12c81" id="r_adf87f282b50fc42ee5cad7f2a4d12c81"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#adf87f282b50fc42ee5cad7f2a4d12c81">xsendfile</a> ($contenthash)</td></tr>
<tr class="memdesc:adf87f282b50fc42ee5cad7f2a4d12c81"><td class="mdescLeft">&#160;</td><td class="mdescRight">Serve file content using X-Sendfile header.  <br /></td></tr>
<tr class="separator:adf87f282b50fc42ee5cad7f2a4d12c81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68fd5e3474ddb40a01de71cfa87eac23" id="r_a68fd5e3474ddb40a01de71cfa87eac23"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a68fd5e3474ddb40a01de71cfa87eac23">xsendfile_file</a> (<a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> $file)</td></tr>
<tr class="memdesc:a68fd5e3474ddb40a01de71cfa87eac23"><td class="mdescLeft">&#160;</td><td class="mdescRight">Serve file content using X-Sendfile header.  <br /></td></tr>
<tr class="separator:a68fd5e3474ddb40a01de71cfa87eac23"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a90bf81d29dff9ecb5dc5c5961974e377" id="r_a90bf81d29dff9ecb5dc5c5961974e377"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a90bf81d29dff9ecb5dc5c5961974e377">can_convert_documents</a> ()</td></tr>
<tr class="memdesc:a90bf81d29dff9ecb5dc5c5961974e377"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the installed version of unoconv is supported.  <br /></td></tr>
<tr class="separator:a90bf81d29dff9ecb5dc5c5961974e377"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02d4083dc8ffff228ecd90499864cdcb" id="r_a02d4083dc8ffff228ecd90499864cdcb"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a02d4083dc8ffff228ecd90499864cdcb">get_pathname_hash</a> ($contextid, $component, $filearea, $itemid, $filepath, $filename)</td></tr>
<tr class="memdesc:a02d4083dc8ffff228ecd90499864cdcb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates sha1 hash of unique full path name information.  <br /></td></tr>
<tr class="separator:a02d4083dc8ffff228ecd90499864cdcb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83eac93c66fc3a129e56154144be505c" id="r_a83eac93c66fc3a129e56154144be505c"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a83eac93c66fc3a129e56154144be505c">hash_from_path</a> ($filepath)</td></tr>
<tr class="memdesc:a83eac93c66fc3a129e56154144be505c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate and return the contenthash of the supplied file.  <br /></td></tr>
<tr class="separator:a83eac93c66fc3a129e56154144be505c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c7412cd9652bdd7c86125f55942693c" id="r_a9c7412cd9652bdd7c86125f55942693c"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a9c7412cd9652bdd7c86125f55942693c">hash_from_string</a> ($content)</td></tr>
<tr class="memdesc:a9c7412cd9652bdd7c86125f55942693c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate and return the contenthash of the supplied content.  <br /></td></tr>
<tr class="separator:a9c7412cd9652bdd7c86125f55942693c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf01265bc89b8c19b893ed7e98d36262" id="r_acf01265bc89b8c19b893ed7e98d36262"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#acf01265bc89b8c19b893ed7e98d36262">mimetype</a> ($fullpath, $filename=null)</td></tr>
<tr class="memdesc:acf01265bc89b8c19b893ed7e98d36262"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return mimetype by given file pathname.  <br /></td></tr>
<tr class="separator:acf01265bc89b8c19b893ed7e98d36262"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a764250088aeb5390831a5d6e085a0f" id="r_a4a764250088aeb5390831a5d6e085a0f"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a4a764250088aeb5390831a5d6e085a0f">mimetype_from_file</a> ($fullpath)</td></tr>
<tr class="memdesc:a4a764250088aeb5390831a5d6e085a0f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inspect a file on disk for it's mimetype.  <br /></td></tr>
<tr class="separator:a4a764250088aeb5390831a5d6e085a0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c9fcb3519c710b96170f9edeb70e75b" id="r_a0c9fcb3519c710b96170f9edeb70e75b"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a0c9fcb3519c710b96170f9edeb70e75b">pack_reference</a> ($params)</td></tr>
<tr class="memdesc:a0c9fcb3519c710b96170f9edeb70e75b"><td class="mdescLeft">&#160;</td><td class="mdescRight">When user referring to a moodle file, we build the reference field.  <br /></td></tr>
<tr class="separator:a0c9fcb3519c710b96170f9edeb70e75b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a873497f140fa4404cf86ecbbed5f3da3" id="r_a873497f140fa4404cf86ecbbed5f3da3"><td class="memItemLeft" align="right" valign="top"><a id="a873497f140fa4404cf86ecbbed5f3da3" name="a873497f140fa4404cf86ecbbed5f3da3"></a>
static&#160;</td><td class="memItemRight" valign="bottom"><b>send_test_pdf</b> ()</td></tr>
<tr class="memdesc:a873497f140fa4404cf86ecbbed5f3da3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Regenerate the test pdf and send it direct to the browser. <br /></td></tr>
<tr class="separator:a873497f140fa4404cf86ecbbed5f3da3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef4cbc916b696b04fb546cc8663e35e6" id="r_aef4cbc916b696b04fb546cc8663e35e6"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#aef4cbc916b696b04fb546cc8663e35e6">test_unoconv_path</a> ()</td></tr>
<tr class="memdesc:aef4cbc916b696b04fb546cc8663e35e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if unoconv configured path is correct and working.  <br /></td></tr>
<tr class="separator:aef4cbc916b696b04fb546cc8663e35e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01b03f9779822003106148f9dac08744" id="r_a01b03f9779822003106148f9dac08744"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a01b03f9779822003106148f9dac08744">unpack_reference</a> ($str, $cleanparams=false)</td></tr>
<tr class="memdesc:a01b03f9779822003106148f9dac08744"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unpack reference field.  <br /></td></tr>
<tr class="separator:a01b03f9779822003106148f9dac08744"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-methods" name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a7ee6edd62f41febfd49582db6989d3d2" id="r_a7ee6edd62f41febfd49582db6989d3d2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a7ee6edd62f41febfd49582db6989d3d2">call_before_file_created_plugin_functions</a> ($newrecord, $pathname=null, $content=null)</td></tr>
<tr class="memdesc:a7ee6edd62f41febfd49582db6989d3d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">before_file_created hook.  <br /></td></tr>
<tr class="separator:a7ee6edd62f41febfd49582db6989d3d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a405ed37f106f7a386d9a3f6918dfce70" id="r_a405ed37f106f7a386d9a3f6918dfce70"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a405ed37f106f7a386d9a3f6918dfce70">create_file</a> ($newrecord)</td></tr>
<tr class="memdesc:a405ed37f106f7a386d9a3f6918dfce70"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add new file record to database and handle callbacks.  <br /></td></tr>
<tr class="separator:a405ed37f106f7a386d9a3f6918dfce70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79caf47d8d513f0640948d7a95278cd8" id="r_a79caf47d8d513f0640948d7a95278cd8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a79caf47d8d513f0640948d7a95278cd8">create_file_preview</a> (<a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> $file, $mode)</td></tr>
<tr class="memdesc:a79caf47d8d513f0640948d7a95278cd8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates a preview image for the stored file.  <br /></td></tr>
<tr class="separator:a79caf47d8d513f0640948d7a95278cd8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae18cc16f5ed23792152e034cca752cc6" id="r_ae18cc16f5ed23792152e034cca752cc6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#ae18cc16f5ed23792152e034cca752cc6">create_imagefile_preview</a> (<a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> $file, $mode)</td></tr>
<tr class="memdesc:ae18cc16f5ed23792152e034cca752cc6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates a preview for the stored image file.  <br /></td></tr>
<tr class="separator:ae18cc16f5ed23792152e034cca752cc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae99cf2098748e599c8ba5c70d48e8a2" id="r_aae99cf2098748e599c8ba5c70d48e8a2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#aae99cf2098748e599c8ba5c70d48e8a2">is_format_supported_by_unoconv</a> ($format)</td></tr>
<tr class="memdesc:aae99cf2098748e599c8ba5c70d48e8a2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verify the format is supported.  <br /></td></tr>
<tr class="separator:aae99cf2098748e599c8ba5c70d48e8a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6bab95b45b0d4c6773041e0e010a8fc8" id="r_a6bab95b45b0d4c6773041e0e010a8fc8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/ddd/classfile__storage.html#a6bab95b45b0d4c6773041e0e010a8fc8">sort_area_tree</a> ($tree)</td></tr>
<tr class="memdesc:a6bab95b45b0d4c6773041e0e010a8fc8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sorts the result of <a class="el" href="../../">file_storage::get_area_tree()</a>.  <br /></td></tr>
<tr class="separator:a6bab95b45b0d4c6773041e0e010a8fc8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a0026bbe75557006ca922deff2af2b76e" name="a0026bbe75557006ca922deff2af2b76e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0026bbe75557006ca922deff2af2b76e">&#9670;&#160;</a></span>add_file_to_pool()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::add_file_to_pool </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$pathname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contenthash</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$newrecord</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add file content to sha1 pool. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$pathname</td><td>path to file </td></tr>
    <tr><td class="paramtype">string&#160;|&#160;null</td><td class="paramname">$contenthash</td><td>sha1 hash of content if known (performance only) </td></tr>
    <tr><td class="paramtype">stdClass&#160;|&#160;null</td><td class="paramname">$newrecord</td><td>New file record </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>(contenthash, filesize, newfile) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aef6751bccfe15c2c8d79640c3b0fa498" name="aef6751bccfe15c2c8d79640c3b0fa498"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef6751bccfe15c2c8d79640c3b0fa498">&#9670;&#160;</a></span>add_string_to_pool()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::add_string_to_pool </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$content</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$newrecord</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add string content to sha1 pool. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$content</td><td>file content - binary string </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>(contenthash, filesize, newfile) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a7ee6edd62f41febfd49582db6989d3d2" name="a7ee6edd62f41febfd49582db6989d3d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ee6edd62f41febfd49582db6989d3d2">&#9670;&#160;</a></span>call_before_file_created_plugin_functions()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::call_before_file_created_plugin_functions </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$newrecord</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$pathname</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$content</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>before_file_created hook. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass&#160;|&#160;null</td><td class="paramname">$newrecord</td><td>New file record. </td></tr>
    <tr><td class="paramtype">string&#160;|&#160;null</td><td class="paramname">$pathname</td><td>Path to file. </td></tr>
    <tr><td class="paramtype">string&#160;|&#160;null</td><td class="paramname">$content</td><td>File content. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a90bf81d29dff9ecb5dc5c5961974e377" name="a90bf81d29dff9ecb5dc5c5961974e377"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90bf81d29dff9ecb5dc5c5961974e377">&#9670;&#160;</a></span>can_convert_documents()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static file_storage::can_convert_documents </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if the installed version of unoconv is supported. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>true if the present version is supported, false otherwise. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a3654090827bf595f24abb3e8a83f02fc" name="a3654090827bf595f24abb3e8a83f02fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3654090827bf595f24abb3e8a83f02fc">&#9670;&#160;</a></span>content_exists()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::content_exists </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contenthash</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Content exists. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$contenthash</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="deprecated"><dt><b><a class="el" href="../../da/d58/deprecated.html#_deprecated000509">Deprecated:</a></b></dt><dd>since 3.3 </dd></dl>

</div>
</div>
<a id="ae67ad83823a0eddf8bf6f2dc5191bc44" name="ae67ad83823a0eddf8bf6f2dc5191bc44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae67ad83823a0eddf8bf6f2dc5191bc44">&#9670;&#160;</a></span>convert_image()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::convert_image </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filerecord</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$newwidth</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$newheight</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$keepaspectratio</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$quality</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates new image file from existing. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass&#160;|&#160;array</td><td class="paramname">$filerecord</td><td>object or array describing new file </td></tr>
    <tr><td class="paramtype">int&#160;|&#160;<a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td class="paramname">$fid</td><td>file id or stored file object </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$newwidth</td><td>in pixels </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$newheight</td><td>in pixels </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$keepaspectratio</td><td>whether or not keep aspect ratio </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$quality</td><td>depending on image type 0-100 for jpeg, 0-9 (0 means no compression) for png </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4126b4780ec9a34b1bf45d46c96ea57f" name="a4126b4780ec9a34b1bf45d46c96ea57f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4126b4780ec9a34b1bf45d46c96ea57f">&#9670;&#160;</a></span>create_directory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::create_directory </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contextid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$component</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filearea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$itemid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filepath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$userid</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Recursively creates directory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$contextid</td><td>context ID </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$component</td><td>component </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filearea</td><td>file area </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$itemid</td><td>item ID </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filepath</td><td>file path </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userid</td><td>the user ID </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>success </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a405ed37f106f7a386d9a3f6918dfce70" name="a405ed37f106f7a386d9a3f6918dfce70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a405ed37f106f7a386d9a3f6918dfce70">&#9670;&#160;</a></span>create_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::create_file </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$newrecord</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Add new file record to database and handle callbacks. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass</td><td class="paramname">$newrecord</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a6c069fbadc065de61e20cd4941cba04f" name="a6c069fbadc065de61e20cd4941cba04f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c069fbadc065de61e20cd4941cba04f">&#9670;&#160;</a></span>create_file_from_pathname()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::create_file_from_pathname </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filerecord</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$pathname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add new local file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass&#160;|&#160;array</td><td class="paramname">$filerecord</td><td>object or array describing file </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$pathname</td><td>path to file or content of file </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a7c73955832528e27618244f864bbe254" name="a7c73955832528e27618244f864bbe254"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c73955832528e27618244f864bbe254">&#9670;&#160;</a></span>create_file_from_reference()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::create_file_from_reference </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filerecord</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$repositoryid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$reference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$options</em> = <code>array()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a new alias/shortcut file from file reference information. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass&#160;|&#160;array</td><td class="paramname">$filerecord</td><td>object or array describing the new file </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$repositoryid</td><td>the id of the repository that provides the original file </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$reference</td><td>the information required by the repository to locate the original file </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>options for creating the new file </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9275f276950e9820d34b1a7cd2235708" name="a9275f276950e9820d34b1a7cd2235708"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9275f276950e9820d34b1a7cd2235708">&#9670;&#160;</a></span>create_file_from_storedfile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::create_file_from_storedfile </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filerecord</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fileorid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add new local file based on existing local file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass&#160;|&#160;array</td><td class="paramname">$filerecord</td><td>object or array describing changes </td></tr>
    <tr><td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a>&#160;|&#160;int</td><td class="paramname">$fileorid</td><td>id or <a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> instance of the existing local file </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td>instance of newly created file </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a49a9328770527260ab28a683b15d007a" name="a49a9328770527260ab28a683b15d007a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a49a9328770527260ab28a683b15d007a">&#9670;&#160;</a></span>create_file_from_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::create_file_from_string </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filerecord</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$content</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add new local file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass&#160;|&#160;array</td><td class="paramname">$filerecord</td><td>object or array describing file </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$content</td><td>content of file </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af9cd50a05d0314e19156504575d7878b" name="af9cd50a05d0314e19156504575d7878b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9cd50a05d0314e19156504575d7878b">&#9670;&#160;</a></span>create_file_from_url()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::create_file_from_url </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filerecord</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$url</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array&#160;</td>
          <td class="paramname"><em>$options</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$usetempfile</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add new local file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass&#160;|&#160;array</td><td class="paramname">$filerecord</td><td>object or array describing file </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$url</td><td>the URL to the file </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td><a class="el" href="../../#gaa2a61814cfc45a7903e00bf746acbd0e">download_file_content()</a> options </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$usetempfile</td><td>use temporary file for download, may prevent out of memory problems </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a79caf47d8d513f0640948d7a95278cd8" name="a79caf47d8d513f0640948d7a95278cd8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79caf47d8d513f0640948d7a95278cd8">&#9670;&#160;</a></span>create_file_preview()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::create_file_preview </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a>&#160;</td>
          <td class="paramname"><em>$file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generates a preview image for the stored file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td class="paramname">$file</td><td>the file we want to preview </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$mode</td><td>preview mode, eg. 'thumb' </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">stored_file|bool</td><td>the newly created preview file or false </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ae18cc16f5ed23792152e034cca752cc6" name="ae18cc16f5ed23792152e034cca752cc6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae18cc16f5ed23792152e034cca752cc6">&#9670;&#160;</a></span>create_imagefile_preview()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::create_imagefile_preview </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a>&#160;</td>
          <td class="paramname"><em>$file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generates a preview for the stored image file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td class="paramname">$file</td><td>the image we want to preview </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$mode</td><td>preview mode, eg. 'thumb' </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">string|bool</td><td>false if a problem occurs, the thumbnail image data otherwise </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a6f2e8702ddbba81e134e5e328c927e41" name="a6f2e8702ddbba81e134e5e328c927e41"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f2e8702ddbba81e134e5e328c927e41">&#9670;&#160;</a></span>delete_area_files()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::delete_area_files </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contextid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$component</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filearea</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$itemid</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Delete all area files (optionally limited by itemid). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$contextid</td><td>context ID </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$component</td><td>component </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filearea</td><td>file area or all areas in context if not specified </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$itemid</td><td>item ID or all files if not specified </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>success </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a6eed3316c1a8f2e7ef6537a176d83a39" name="a6eed3316c1a8f2e7ef6537a176d83a39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6eed3316c1a8f2e7ef6537a176d83a39">&#9670;&#160;</a></span>delete_area_files_select()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::delete_area_files_select </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contextid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$component</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filearea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$itemidstest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array&#160;</td>
          <td class="paramname"><em>$params</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Delete all the files from certain areas where itemid is limited by an arbitrary bit of SQL. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$contextid</td><td>the id of the context the files belong to. Must be given. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$component</td><td>the owning component. Must be given. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filearea</td><td>the file area name. Must be given. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$itemidstest</td><td>an SQL fragment that the itemid must match. Used in the query like WHERE itemid $itemidstest. Must used named parameters, and may not used named parameters called contextid, component or filearea. </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$params</td><td>any query params used by $itemidstest. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4725ec33fb4f420e0207c140406ca028" name="a4725ec33fb4f420e0207c140406ca028"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4725ec33fb4f420e0207c140406ca028">&#9670;&#160;</a></span>delete_component_files()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::delete_component_files </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$component</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Delete all files associated with the given component. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$component</td><td>the component owning the file </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a5ef2e0a68700490d799397e085cf60d2" name="a5ef2e0a68700490d799397e085cf60d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ef2e0a68700490d799397e085cf60d2">&#9670;&#160;</a></span>file_exists()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::file_exists </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contextid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$component</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filearea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$itemid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filepath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filename</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Does this file exist? </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$contextid</td><td>context ID </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$component</td><td>component </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filearea</td><td>file area </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$itemid</td><td>item ID </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filepath</td><td>file path </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filename</td><td>file name </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ad693fe9f5fc095a8f7f6991d45c6279e" name="ad693fe9f5fc095a8f7f6991d45c6279e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad693fe9f5fc095a8f7f6991d45c6279e">&#9670;&#160;</a></span>file_exists_by_hash()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::file_exists_by_hash </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$pathnamehash</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Whether or not the file exist. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$pathnamehash</td><td>path name hash </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aaf11ed9a82d7e1771dbfdc6b4f3a5f96" name="aaf11ed9a82d7e1771dbfdc6b4f3a5f96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf11ed9a82d7e1771dbfdc6b4f3a5f96">&#9670;&#160;</a></span>get_area_files()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::get_area_files </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contextid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$component</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filearea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$itemid</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$sort</em> = <code>&quot;itemid,&#160;filepath,&#160;filename&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$includedirs</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$updatedsince</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$limitfrom</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$limitnum</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns all area files (optionally limited by itemid) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$contextid</td><td>context ID </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$component</td><td>component </td></tr>
    <tr><td class="paramtype">mixed</td><td class="paramname">$filearea</td><td>file area/s, you cannot specify multiple fileareas as well as an itemid </td></tr>
    <tr><td class="paramtype">int&#160;|&#160;int[]&#160;|&#160;false</td><td class="paramname">$itemid</td><td>item ID(s) or all files if not specified </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$sort</td><td>A fragment of SQL to use for sorting </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$includedirs</td><td>whether or not include directories </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$updatedsince</td><td>return files updated since this time </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$limitfrom</td><td>return a subset of records, starting at this point (optional). </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$limitnum</td><td>return a subset comprising this many records in total (optional, required if $limitfrom is set). </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">stored_file[]</td><td>array of stored_files indexed by pathanmehash </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a1747f21ff461d428d2268ca711739725" name="a1747f21ff461d428d2268ca711739725"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1747f21ff461d428d2268ca711739725">&#9670;&#160;</a></span>get_area_tree()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::get_area_tree </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contextid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$component</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filearea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$itemid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns array based tree structure of area files. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$contextid</td><td>context ID </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$component</td><td>component </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filearea</td><td>file area </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$itemid</td><td>item ID </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>each dir represented by dirname, subdirs, files and dirfile array elements </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a933e57fa5324fc316ba76e72d4e43183" name="a933e57fa5324fc316ba76e72d4e43183"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a933e57fa5324fc316ba76e72d4e43183">&#9670;&#160;</a></span>get_converted_document()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::get_converted_document </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a>&#160;</td>
          <td class="paramname"><em>$file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$forcerefresh</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get converted document. </p>
<p>Get an alternate version of the specified document, if it is possible to convert.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td class="paramname">$file</td><td>the file we want to preview </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$format</td><td>The desired format - e.g. 'pdf'. Formats are specified by file extension. </td></tr>
    <tr><td class="paramtype">boolean</td><td class="paramname">$forcerefresh</td><td>If true, the file will be converted every time (not cached). </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">stored_file|bool</td><td>false if unable to create the conversion, stored file otherwise </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4a1dc9e0e91cb61f8fb8c0cee2a4471e" name="a4a1dc9e0e91cb61f8fb8c0cee2a4471e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a1dc9e0e91cb61f8fb8c0cee2a4471e">&#9670;&#160;</a></span>get_directory_files()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::get_directory_files </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contextid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$component</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filearea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$itemid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filepath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$recursive</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$includedirs</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$sort</em> = <code>&quot;filepath,&#160;filename&quot;</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns all files and optionally directories. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$contextid</td><td>context ID </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$component</td><td>component </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filearea</td><td>file area </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$itemid</td><td>item ID </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$filepath</td><td>directory path </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$recursive</td><td>include all subdirectories </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$includedirs</td><td>include files and directories </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$sort</td><td>A fragment of SQL to use for sorting </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>of stored_files indexed by pathanmehash </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a6643684a1236c2f8ad128f454944b6c0" name="a6643684a1236c2f8ad128f454944b6c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6643684a1236c2f8ad128f454944b6c0">&#9670;&#160;</a></span>get_external_files()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::get_external_files </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$repositoryid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$sort</em> = <code>''</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns all files belonging to given repository. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$repositoryid</td><td></td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$sort</td><td>A fragment of SQL to use for sorting </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac7ae000f33b92cb34482303cbce552c4" name="ac7ae000f33b92cb34482303cbce552c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac7ae000f33b92cb34482303cbce552c4">&#9670;&#160;</a></span>get_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::get_file </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contextid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$component</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filearea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$itemid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filepath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filename</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fetch locally stored file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$contextid</td><td>context ID </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$component</td><td>component </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filearea</td><td>file area </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$itemid</td><td>item ID </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filepath</td><td>file path </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filename</td><td>file name </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">stored_file|bool</td><td><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> instance if exists, false if not </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aef265ef7ad4760ef4365b6aa9c73c466" name="aef265ef7ad4760ef4365b6aa9c73c466"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef265ef7ad4760ef4365b6aa9c73c466">&#9670;&#160;</a></span>get_file_by_hash()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::get_file_by_hash </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$pathnamehash</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fetch file using local file full pathname hash. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$pathnamehash</td><td>path name hash </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">stored_file|bool</td><td><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> instance if exists, false if not </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="adc0fdfdf216e51344b64f19869f3a9b8" name="adc0fdfdf216e51344b64f19869f3a9b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc0fdfdf216e51344b64f19869f3a9b8">&#9670;&#160;</a></span>get_file_by_id()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::get_file_by_id </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fileid</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fetch file using local file id. </p>
<p>Please do not rely on file ids, it is usually easier to use pathname hashes instead.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$fileid</td><td>file ID </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">stored_file|bool</td><td><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> instance if exists, false if not </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa05647c5ed68ff7f5ec0b7ea434960af" name="aa05647c5ed68ff7f5ec0b7ea434960af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa05647c5ed68ff7f5ec0b7ea434960af">&#9670;&#160;</a></span>get_file_instance()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::get_file_instance </td>
          <td>(</td>
          <td class="paramtype">stdClass&#160;</td>
          <td class="paramname"><em>$filerecord</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create instance of file class from database record. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass</td><td class="paramname">$filerecord</td><td>record from the files table left join files_reference table </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td>instance of file abstraction class </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a2df31efb57e898498a490bf04d0aff51" name="a2df31efb57e898498a490bf04d0aff51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2df31efb57e898498a490bf04d0aff51">&#9670;&#160;</a></span>get_file_preview()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::get_file_preview </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a>&#160;</td>
          <td class="paramname"><em>$file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns an image file that represent the given stored file as a preview. </p>
<p>At the moment, only GIF, JPEG, PNG and SVG files are supported to have previews. In the future, the support for other mimetypes can be added, too (eg. generate an image preview of PDF, text documents etc).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td class="paramname">$file</td><td>the file we want to preview </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$mode</td><td>preview mode, eg. 'thumb' </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">stored_file|bool</td><td>false if unable to create the preview, stored file otherwise </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a5a00b81cd7da91b786c266a7521848a2" name="a5a00b81cd7da91b786c266a7521848a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a00b81cd7da91b786c266a7521848a2">&#9670;&#160;</a></span>get_file_system()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::get_file_system </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the file system instance. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="../../df/d66/classfile__system.html">file_system</a></td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a02d4083dc8ffff228ecd90499864cdcb" name="a02d4083dc8ffff228ecd90499864cdcb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02d4083dc8ffff228ecd90499864cdcb">&#9670;&#160;</a></span>get_pathname_hash()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static file_storage::get_pathname_hash </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contextid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$component</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filearea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$itemid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filepath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filename</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculates sha1 hash of unique full path name information. </p>
<p>This hash is a unique file identifier - it is used to improve performance and overcome db index size limits.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$contextid</td><td>context ID </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$component</td><td>component </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filearea</td><td>file area </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$itemid</td><td>item ID </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filepath</td><td>file path </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filename</td><td>file name </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">string</td><td>sha1 hash </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac5e64700148cc3751592934c060a34b5" name="ac5e64700148cc3751592934c060a34b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac5e64700148cc3751592934c060a34b5">&#9670;&#160;</a></span>get_references_by_storedfile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::get_references_by_storedfile </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a>&#160;</td>
          <td class="paramname"><em>$storedfile</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns all aliases that link to the given <a class="el" href="../../d0/d00/classstored__file.html">stored_file</a>. </p>
<p>Aliases in user draft areas are excluded from the returned list.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td class="paramname">$storedfile</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>of <a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ad599580b5f192a86f4d6b627a21e5aa9" name="ad599580b5f192a86f4d6b627a21e5aa9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad599580b5f192a86f4d6b627a21e5aa9">&#9670;&#160;</a></span>get_references_count_by_storedfile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::get_references_count_by_storedfile </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a>&#160;</td>
          <td class="paramname"><em>$storedfile</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the number of aliases that link to the given <a class="el" href="../../d0/d00/classstored__file.html">stored_file</a>. </p>
<p>Aliases in user draft areas are not counted.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td class="paramname">$storedfile</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a1ce0acb9dcbbcf980b6f7ca19f60fd4a" name="a1ce0acb9dcbbcf980b6f7ca19f60fd4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ce0acb9dcbbcf980b6f7ca19f60fd4a">&#9670;&#160;</a></span>get_unused_dirname()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::get_unused_dirname </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contextid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$component</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filearea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$itemid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$suggestedpath</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return an available directory name. </p>
<p>This will return the next available directory name in the area, adding/incrementing a suffix of the last portion of path, ie: /path/ &gt; /path (1)/ &gt; /path (2)/ &gt; etc...</p>
<p>If the file path passed is available without modification, it is returned as is.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$contextid</td><td>context ID. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$component</td><td>component. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filearea</td><td>file area. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$itemid</td><td>area item ID. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$suggestedpath</td><td>the suggested file path. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">string</td><td>available file path </td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd><a class="el" href="../../d7/d79/namespace_moodle.html" title="&#160;">Moodle</a> 2.5 </dd></dl>

</div>
</div>
<a id="a97c81e35ed4968f3284edb734372fcfa" name="a97c81e35ed4968f3284edb734372fcfa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97c81e35ed4968f3284edb734372fcfa">&#9670;&#160;</a></span>get_unused_filename()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::get_unused_filename </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contextid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$component</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filearea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$itemid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filepath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filename</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return an available file name. </p>
<p>This will return the next available file name in the area, adding/incrementing a suffix of the file, ie: file.txt &gt; file (1).txt &gt; file (2).txt &gt; etc...</p>
<p>If the file name passed is available without modification, it is returned as is.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$contextid</td><td>context ID. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$component</td><td>component. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filearea</td><td>file area. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$itemid</td><td>area item ID. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filepath</td><td>the file path. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filename</td><td>the file name. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">string</td><td>available file name. </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="../../da/d34/classcoding__exception.html" title="Exception indicating programming error, must be fixed by a programer.">coding_exception</a></td><td>if the file name is invalid. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd><a class="el" href="../../d7/d79/namespace_moodle.html" title="&#160;">Moodle</a> 2.5 </dd></dl>

</div>
</div>
<a id="ad26cf68902db0683e1175cc32b106ef9" name="ad26cf68902db0683e1175cc32b106ef9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad26cf68902db0683e1175cc32b106ef9">&#9670;&#160;</a></span>get_user_draft_items()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::get_user_draft_items </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>$userid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>$updatedsince</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>$lastnum</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the file area item ids and their updatetime for a user's draft uploads, sorted by updatetime DESC. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$userid</td><td>user id </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$updatedsince</td><td>only return draft areas updated since this time </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$lastnum</td><td>only return the last specified numbers </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a83eac93c66fc3a129e56154144be505c" name="a83eac93c66fc3a129e56154144be505c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83eac93c66fc3a129e56154144be505c">&#9670;&#160;</a></span>hash_from_path()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static file_storage::hash_from_path </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filepath</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate and return the contenthash of the supplied file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$filepath</td><td>The path to the file on disk </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">string</td><td>The file's content hash </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9c7412cd9652bdd7c86125f55942693c" name="a9c7412cd9652bdd7c86125f55942693c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c7412cd9652bdd7c86125f55942693c">&#9670;&#160;</a></span>hash_from_string()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static file_storage::hash_from_string </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$content</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate and return the contenthash of the supplied content. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$content</td><td>The file content </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">string</td><td>The file's content hash </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a0591bec4e68b964ef7f5f7d26758226a" name="a0591bec4e68b964ef7f5f7d26758226a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0591bec4e68b964ef7f5f7d26758226a">&#9670;&#160;</a></span>import_external_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::import_external_file </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a>&#160;</td>
          <td class="paramname"><em>$storedfile</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$maxbytes</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert file alias to local file. </p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="../../d6/da8/classmoodle__exception.html" title="Base Moodle Exception class.">moodle_exception</a></td><td>if file could not be downloaded</td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td class="paramname">$storedfile</td><td>a <a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> instances </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$maxbytes</td><td>throw an exception if file size is bigger than $maxbytes (0 means no limit) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4b5eaf0936f8d2cf78c06dffaeca5323" name="a4b5eaf0936f8d2cf78c06dffaeca5323"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b5eaf0936f8d2cf78c06dffaeca5323">&#9670;&#160;</a></span>is_area_empty()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::is_area_empty </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contextid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$component</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filearea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$itemid</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$ignoredirs</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Are there any files (or directories) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$contextid</td><td>context ID </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$component</td><td>component </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filearea</td><td>file area </td></tr>
    <tr><td class="paramtype">bool&#160;|&#160;int</td><td class="paramname">$itemid</td><td>item id or false if all items </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$ignoredirs</td><td>whether or not ignore directories </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>empty </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aae99cf2098748e599c8ba5c70d48e8a2" name="aae99cf2098748e599c8ba5c70d48e8a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae99cf2098748e599c8ba5c70d48e8a2">&#9670;&#160;</a></span>is_format_supported_by_unoconv()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::is_format_supported_by_unoconv </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$format</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Verify the format is supported. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$format</td><td>The desired format - e.g. 'pdf'. Formats are specified by file extension. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>- True if the format is supported for input. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="acf01265bc89b8c19b893ed7e98d36262" name="acf01265bc89b8c19b893ed7e98d36262"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf01265bc89b8c19b893ed7e98d36262">&#9670;&#160;</a></span>mimetype()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static file_storage::mimetype </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fullpath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filename</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return mimetype by given file pathname. </p>
<p>If file has a known extension, we return the mimetype based on extension. Otherwise (when possible) we try to get the mimetype from file contents.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$fullpath</td><td>Full path to the file on disk </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filename</td><td>Correct file name with extension, if omitted will be taken from $path </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">string</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4a764250088aeb5390831a5d6e085a0f" name="a4a764250088aeb5390831a5d6e085a0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a764250088aeb5390831a5d6e085a0f">&#9670;&#160;</a></span>mimetype_from_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static file_storage::mimetype_from_file </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fullpath</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Inspect a file on disk for it's mimetype. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$fullpath</td><td>Path to file on disk </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">string</td><td>The mimetype </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aeeb9ea6ece4c02ebd3bdc61126dcf355" name="aeeb9ea6ece4c02ebd3bdc61126dcf355"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeeb9ea6ece4c02ebd3bdc61126dcf355">&#9670;&#160;</a></span>move_area_files_to_new_context()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::move_area_files_to_new_context </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$oldcontextid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$newcontextid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$component</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filearea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$itemid</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Move all the files in a file area from one context to another. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$oldcontextid</td><td>the context the files are being moved from. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$newcontextid</td><td>the context the files are being moved to. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$component</td><td>the plugin that these files belong to. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filearea</td><td>the name of the file area. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$itemid</td><td>file item ID </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td>the number of files moved, for information. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a0c9fcb3519c710b96170f9edeb70e75b" name="a0c9fcb3519c710b96170f9edeb70e75b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c9fcb3519c710b96170f9edeb70e75b">&#9670;&#160;</a></span>pack_reference()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static file_storage::pack_reference </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$params</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>When user referring to a moodle file, we build the reference field. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$params</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">string</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af55999ceba6e30fb8b84cbd65d97348d" name="af55999ceba6e30fb8b84cbd65d97348d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af55999ceba6e30fb8b84cbd65d97348d">&#9670;&#160;</a></span>search_references()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::search_references </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$reference</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns all aliases that refer to some <a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> via the given reference. </p>
<p>All repositories that provide access to a <a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> are expected to use <a class="el" href="../../">self::pack_reference()</a>. This method can't be used if the given reference does not use this format or if you are looking for references to an external file (for example it can't be used to search for all aliases that refer to a given Dropbox or Box.net file).</p>
<p>Aliases in user draft areas are excluded from the returned list.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$reference</td><td>identification of the referenced file </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>of <a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> indexed by its pathnamehash </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="afefbf8f6d4c1f3e8ed6597ff78388ad9" name="afefbf8f6d4c1f3e8ed6597ff78388ad9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afefbf8f6d4c1f3e8ed6597ff78388ad9">&#9670;&#160;</a></span>search_references_count()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::search_references_count </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$reference</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the number of aliases that refer to some <a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> via the given reference. </p>
<p>All repositories that provide access to a <a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> are expected to use <a class="el" href="../../">self::pack_reference()</a>. This method can't be used if the given reference does not use this format or if you are looking for references to an external file (for example it can't be used to count aliases that refer to a given Dropbox or Box.net file).</p>
<p>Aliases in user draft areas are not counted.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$reference</td><td>identification of the referenced file </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a03c51dde641a58299f0b43282490ea2e" name="a03c51dde641a58299f0b43282490ea2e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03c51dde641a58299f0b43282490ea2e">&#9670;&#160;</a></span>search_server_files()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::search_server_files </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$from</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$limit</em> = <code>20</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$count</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Search through the server files. </p>
<p>The query parameter will be used in conjuction with the SQL directive LIKE, so include '' in it if you need to. This search will always ignore user files and directories. Note that the search is case insensitive.</p>
<p>This query can quickly become inefficient so use it sparignly.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$query</td><td>The string used with SQL LIKE. </td></tr>
    <tr><td class="paramtype">integer</td><td class="paramname">$from</td><td>The offset to start the search at. </td></tr>
    <tr><td class="paramtype">integer</td><td class="paramname">$limit</td><td>The maximum number of results. </td></tr>
    <tr><td class="paramtype">boolean</td><td class="paramname">$count</td><td>When true this methods returns the number of results availabe, disregarding the parameters $from and $limit. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int|array</td><td>Integer when count, otherwise array of <a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> objects. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a674b8abdc52ed6d010a99c40e8d37464" name="a674b8abdc52ed6d010a99c40e8d37464"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a674b8abdc52ed6d010a99c40e8d37464">&#9670;&#160;</a></span>setup_file_system()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::setup_file_system </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Complete setup procedure for the <a class="el" href="../../df/d66/classfile__system.html">file_system</a> component. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="../../df/d66/classfile__system.html">file_system</a></td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a6bab95b45b0d4c6773041e0e010a8fc8" name="a6bab95b45b0d4c6773041e0e010a8fc8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6bab95b45b0d4c6773041e0e010a8fc8">&#9670;&#160;</a></span>sort_area_tree()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::sort_area_tree </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$tree</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sorts the result of <a class="el" href="../../">file_storage::get_area_tree()</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$tree</td><td>Array of results provided by <a class="el" href="../../">file_storage::get_area_tree()</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>of sorted results </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a746b11c0a6e6f6a3d1a0a2ac8938df2c" name="a746b11c0a6e6f6a3d1a0a2ac8938df2c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a746b11c0a6e6f6a3d1a0a2ac8938df2c">&#9670;&#160;</a></span>supports_xsendfile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::supports_xsendfile </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns true if filesystem is configured to support xsendfile. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a3053fc919b5b3bf68b2f8208c2324ed0" name="a3053fc919b5b3bf68b2f8208c2324ed0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3053fc919b5b3bf68b2f8208c2324ed0">&#9670;&#160;</a></span>synchronise_stored_file_from_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::synchronise_stored_file_from_file </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a>&#160;</td>
          <td class="paramname"><em>$file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filerecord</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Synchronise stored file from file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td class="paramname">$file</td><td>Stored file to synchronise. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$path</td><td>Path to the file to synchronise from. </td></tr>
    <tr><td class="paramtype">stdClass</td><td class="paramname">$filerecord</td><td>The file record from the database. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a7a5e5817a6dc917d86eb865191b8e201" name="a7a5e5817a6dc917d86eb865191b8e201"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a5e5817a6dc917d86eb865191b8e201">&#9670;&#160;</a></span>synchronise_stored_file_from_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::synchronise_stored_file_from_string </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a>&#160;</td>
          <td class="paramname"><em>$file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$content</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filerecord</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Synchronise stored file from string. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td class="paramname">$file</td><td>Stored file to synchronise. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$content</td><td>File content. </td></tr>
    <tr><td class="paramtype">stdClass</td><td class="paramname">$filerecord</td><td>The file record from the database. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aef4cbc916b696b04fb546cc8663e35e6" name="aef4cbc916b696b04fb546cc8663e35e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef4cbc916b696b04fb546cc8663e35e6">&#9670;&#160;</a></span>test_unoconv_path()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static file_storage::test_unoconv_path </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if unoconv configured path is correct and working. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">stdClass</td><td>an object with the test status and the UNOCONVPATH_ constant message. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ad437a46e306726919caca60f1aa4d3d7" name="ad437a46e306726919caca60f1aa4d3d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad437a46e306726919caca60f1aa4d3d7">&#9670;&#160;</a></span>try_content_recovery()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::try_content_recovery </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tries to recover missing content of file from trash. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td class="paramname">$file</td><td><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a> instance </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>success </td></tr>
  </table>
  </dd>
</dl>
<dl class="deprecated"><dt><b><a class="el" href="../../da/d58/deprecated.html#_deprecated000510">Deprecated:</a></b></dt><dd>since 3.3 </dd></dl>

</div>
</div>
<a id="a01b03f9779822003106148f9dac08744" name="a01b03f9779822003106148f9dac08744"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01b03f9779822003106148f9dac08744">&#9670;&#160;</a></span>unpack_reference()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static file_storage::unpack_reference </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$cleanparams</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Unpack reference field. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$str</td><td></td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$cleanparams</td><td>if set to true, array elements will be passed through <a class="el" href="../../d0/de1/group__core.html#gada09acc3576525507f00d7ea22e4aef5">clean_param()</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="../../d0/db4/classfile__reference__exception.html">file_reference_exception</a></td><td>if the $str does not have the expected format </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a0b85dd60109390732b80d81123c68306" name="a0b85dd60109390732b80d81123c68306"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b85dd60109390732b80d81123c68306">&#9670;&#160;</a></span>update_references()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::update_references </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$referencefileid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$lastsync</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$lifetime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contenthash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$filesize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$status</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$timemodified</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Updates a reference to the external resource and all files that use it. </p>
<p>This function is called after synchronisation of an external file and updates the contenthash, filesize and status of all files that reference this external file as well as time last synchronised.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$referencefileid</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$lastsync</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$lifetime</td><td>argument not used any more, liefetime is returned by repository </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$contenthash</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$filesize</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$status</td><td>0 if ok or 666 if source is missing </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$timemodified</td><td>last time modified of the source, if known </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aee81e1e5f840d32e5bf5a6b87cfa41f0" name="aee81e1e5f840d32e5bf5a6b87cfa41f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee81e1e5f840d32e5bf5a6b87cfa41f0">&#9670;&#160;</a></span>update_references_to_storedfile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::update_references_to_storedfile </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a>&#160;</td>
          <td class="paramname"><em>$storedfile</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Updates all files that are referencing this file with the new contenthash and filesize. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td class="paramname">$storedfile</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="adf87f282b50fc42ee5cad7f2a4d12c81" name="adf87f282b50fc42ee5cad7f2a4d12c81"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf87f282b50fc42ee5cad7f2a4d12c81">&#9670;&#160;</a></span>xsendfile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::xsendfile </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$contenthash</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Serve file content using X-Sendfile header. </p>
<p>Please make sure that all headers are already sent and the all access control checks passed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$contenthash</td><td>sah1 hash of the file content to be served </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>success </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a68fd5e3474ddb40a01de71cfa87eac23" name="a68fd5e3474ddb40a01de71cfa87eac23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68fd5e3474ddb40a01de71cfa87eac23">&#9670;&#160;</a></span>xsendfile_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">file_storage::xsendfile_file </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a>&#160;</td>
          <td class="paramname"><em>$file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Serve file content using X-Sendfile header. </p>
<p>Please make sure that all headers are already sent and the all access control checks passed.</p>
<p>This alternate method to <a class="el" href="../../d5/d09/group__core__files.html#gab30721c8b2cdcf34b7c8cacf1fefab98" title="Serve file using X-Sendfile header, this needs special server module or configuration.">xsendfile()</a> allows an alternate file system to use the full file metadata and avoid extra lookups.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype"><a class="el" href="../../d0/d00/classstored__file.html">stored_file</a></td><td class="paramname">$file</td><td>The file to send </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>success </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>lib/filestorage/<b>file_storage.php</b></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Nov 5 2023 02:34:29 for Moodle PHP Documentation by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
