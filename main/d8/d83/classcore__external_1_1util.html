<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Moodle PHP Documentation: core_external\util Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Moodle PHP Documentation"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Moodle-Logo-ReversedWhite_RGB.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Moodle PHP Documentation<span id="projectnumber">&#160;4.4</span>
   </div>
   <div id="projectbrief">Moodle 4.4dev (Build: 20240301) (debed3eace9)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.php','Search');
  $(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../df/d41/namespacecore__external.html">core_external</a></li><li class="navelem"><a class="el" href="../../d8/d83/classcore__external_1_1util.html">util</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="../../db/d8e/classcore__external_1_1util-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">core_external\util Class Reference<div class="ingroups"><a class="el" href="../../dd/d12/group__core__webservice.html">core_webservice</a></div></div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a25b6c68e8124221fdfa462ee05f4996f" id="r_a25b6c68e8124221fdfa462ee05f4996f"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a25b6c68e8124221fdfa462ee05f4996f">delete_service_descriptions</a> (string $component)</td></tr>
<tr class="memdesc:a25b6c68e8124221fdfa462ee05f4996f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delete all pre-built services, related tokens, and external functions information defined for the specified component.  <br /></td></tr>
<tr class="separator:a25b6c68e8124221fdfa462ee05f4996f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab847246c4c2266ed55e2f2e47b14f1a4" id="r_ab847246c4c2266ed55e2f2e47b14f1a4"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab847246c4c2266ed55e2f2e47b14f1a4">format_string</a> ( $content, $context, $striplinks=true, $options=[])</td></tr>
<tr class="memdesc:ab847246c4c2266ed55e2f2e47b14f1a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Format the string to be returned properly as requested by the either the web service server, either by an internally call.  <br /></td></tr>
<tr class="separator:ab847246c4c2266ed55e2f2e47b14f1a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adab6ebdeeb6b344f4731dcbb7a8216a3" id="r_adab6ebdeeb6b344f4731dcbb7a8216a3"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adab6ebdeeb6b344f4731dcbb7a8216a3">format_text</a> ( $text, $textformat, $context, $component=null, $filearea=null, $itemid=null, $options=null)</td></tr>
<tr class="memdesc:adab6ebdeeb6b344f4731dcbb7a8216a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Format the text to be returned properly as requested by the either the web service server, either by an internally call.  <br /></td></tr>
<tr class="separator:adab6ebdeeb6b344f4731dcbb7a8216a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0daa45aecc7585e9d5a4e264bf570b12" id="r_a0daa45aecc7585e9d5a4e264bf570b12"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0daa45aecc7585e9d5a4e264bf570b12">generate_token</a> (int $tokentype, stdClass $service, int $userid, context $context, int $validuntil=0, string $iprestriction='', string $name='')</td></tr>
<tr class="memdesc:a0daa45aecc7585e9d5a4e264bf570b12"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create and return a session linked token.  <br /></td></tr>
<tr class="separator:a0daa45aecc7585e9d5a4e264bf570b12"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35adedeba3f60339c616c3215862a526" id="r_a35adedeba3f60339c616c3215862a526"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a35adedeba3f60339c616c3215862a526">generate_token_for_current_user</a> (stdClass $service)</td></tr>
<tr class="memdesc:a35adedeba3f60339c616c3215862a526"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate or return an existing token for the current authenticated user.  <br /></td></tr>
<tr class="separator:a35adedeba3f60339c616c3215862a526"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e335267a67f048d9fd91b57d49e4c28" id="r_a8e335267a67f048d9fd91b57d49e4c28"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8e335267a67f048d9fd91b57d49e4c28">generate_token_name</a> ()</td></tr>
<tr class="memdesc:a8e335267a67f048d9fd91b57d49e4c28"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate token name.  <br /></td></tr>
<tr class="separator:a8e335267a67f048d9fd91b57d49e4c28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a677141358d58efaea10418fe6b5cc350" id="r_a677141358d58efaea10418fe6b5cc350"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a677141358d58efaea10418fe6b5cc350">get_area_files</a> ($contextid, $component, $filearea, $itemid=false, $useitemidinurl=true)</td></tr>
<tr class="memdesc:a677141358d58efaea10418fe6b5cc350"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns all area files (optionally limited by itemid).  <br /></td></tr>
<tr class="separator:a677141358d58efaea10418fe6b5cc350"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3654ed813868676c6b4be445c36edec" id="r_ab3654ed813868676c6b4be445c36edec"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab3654ed813868676c6b4be445c36edec">get_service_by_id</a> (int $serviceid)</td></tr>
<tr class="memdesc:ab3654ed813868676c6b4be445c36edec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a service by its id.  <br /></td></tr>
<tr class="separator:ab3654ed813868676c6b4be445c36edec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84f7f025ec59f3ced68a46d46bc25603" id="r_a84f7f025ec59f3ced68a46d46bc25603"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a84f7f025ec59f3ced68a46d46bc25603">get_service_by_name</a> (string $name)</td></tr>
<tr class="memdesc:a84f7f025ec59f3ced68a46d46bc25603"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a service by its name.  <br /></td></tr>
<tr class="separator:a84f7f025ec59f3ced68a46d46bc25603"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73a4ac60ad45adf6408911e2f21a7403" id="r_a73a4ac60ad45adf6408911e2f21a7403"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a73a4ac60ad45adf6408911e2f21a7403">log_token_request</a> (stdClass $token)</td></tr>
<tr class="memdesc:a73a4ac60ad45adf6408911e2f21a7403"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the last time a token was sent and trigger the <a class="el" href="../../d4/d40/classcore_1_1event_1_1webservice__token__sent.html" title="Webservice token sent event class.">core::event::webservice_token_sent</a> event.  <br /></td></tr>
<tr class="separator:a73a4ac60ad45adf6408911e2f21a7403"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac31de25f6fd29f86ab0ae23434088541" id="r_ac31de25f6fd29f86ab0ae23434088541"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac31de25f6fd29f86ab0ae23434088541">validate_courses</a> ( $courseids, $courses=[], $addcontext=false, $keepfails=false)</td></tr>
<tr class="memdesc:ac31de25f6fd29f86ab0ae23434088541"><td class="mdescLeft">&#160;</td><td class="mdescRight">Validate a list of courses, returning the complete course objects for valid courses.  <br /></td></tr>
<tr class="separator:ac31de25f6fd29f86ab0ae23434088541"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22543643b8775787127c66ee160daacb" id="r_a22543643b8775787127c66ee160daacb"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a22543643b8775787127c66ee160daacb">validate_format</a> ($format)</td></tr>
<tr class="memdesc:a22543643b8775787127c66ee160daacb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Validate text field format against known FORMAT_XXX.  <br /></td></tr>
<tr class="separator:a22543643b8775787127c66ee160daacb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a25b6c68e8124221fdfa462ee05f4996f" name="a25b6c68e8124221fdfa462ee05f4996f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25b6c68e8124221fdfa462ee05f4996f">&#9670;&#160;</a></span>delete_service_descriptions()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core_external\util::delete_service_descriptions </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$component</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Delete all pre-built services, related tokens, and external functions information defined for the specified component. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$component</td><td>The frankenstyle component name </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab847246c4c2266ed55e2f2e47b14f1a4" name="ab847246c4c2266ed55e2f2e47b14f1a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab847246c4c2266ed55e2f2e47b14f1a4">&#9670;&#160;</a></span>format_string()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core_external\util::format_string </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$content</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$context</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$striplinks</em><span class="paramdefsep"> = </span><span class="paramdefval">true</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$options</em><span class="paramdefsep"> = </span><span class="paramdefval">[]</span></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Format the string to be returned properly as requested by the either the web service server, either by an internally call. </p>
<p>The caller can change the format (raw) with the settings singleton All web service servers must set this singleton when parsing the $_GET and $_POST.</p>
<pre>
Options are the same that in {<dl class="section see"><dt>See also</dt><dd> <a class="el" href="../../d0/de1/group__core.html#ga5d853ba52ad6e416838c5dcc3680aa80" title="Given a simple string, this function returns the string processed by enabled string filters if $CFG-&gt;...">format_string()</a>} with some changes:
     <a class="el" href="../../d4/d38/group__filter.html">filter</a>      : Can be set to false to force filters off, else observes {</dd>
<dd>
 settings}.
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string&#160;|&#160;null</td><td class="paramname">$content</td><td>The string to be filtered. Should be plain text, expect
possibly for multilang tags.
</td></tr>
    <tr><td class="paramtype">context</td><td class="paramname">$context</td><td>The id of the context for the string or the context (affects filters).
</td></tr>
    <tr><td class="paramtype">boolean</td><td class="paramname">$striplinks</td><td>To strip any link in the result text. <a class="el" href="../../d7/d79/namespace_moodle.html" title="&#160;">Moodle</a> 1.8 default changed from false to true! <a href="https://tracker.moodle.org/browse/MDL-8713" class="el">MDL-8713</a>
</td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$options</td><td>options array/object or courseid
</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">string</td><td>text
</td></tr>
  </table>
  </dd>
</dl>
</pre>
</div>
</div>
<a id="adab6ebdeeb6b344f4731dcbb7a8216a3" name="adab6ebdeeb6b344f4731dcbb7a8216a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adab6ebdeeb6b344f4731dcbb7a8216a3">&#9670;&#160;</a></span>format_text()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core_external\util::format_text </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$text</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$textformat</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$context</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$component</em><span class="paramdefsep"> = </span><span class="paramdefval">null</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$filearea</em><span class="paramdefsep"> = </span><span class="paramdefval">null</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$itemid</em><span class="paramdefsep"> = </span><span class="paramdefval">null</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$options</em><span class="paramdefsep"> = </span><span class="paramdefval">null</span></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Format the text to be returned properly as requested by the either the web service server, either by an internally call. </p>
<p>The caller can change the format (raw, filter, file, fileurl) with the core_external::settings singleton All web service servers must set this singleton when parsing the $_GET and $_POST.</p>
<pre>
Options are the same that in {<dl class="section see"><dt>See also</dt><dd> <a class="el" href="../../d0/de1/group__core.html#ga9cf34d3f4b1d8960c459d4a66144da8e" title="Given text in a variety of format codings, this function returns the text as safe HTML.">format_text()</a>} with some changes in defaults to provide backwards compatibility:
     trusted     :   If true the string won't be cleaned. Default false.
     noclean     :   If true the string won't be cleaned only <a class="el" href="../../d8/d07/categoryif.html" title="Advance grading form element.">if</a> trusted is also true. Default false.
     nocache     :   If true the string will not be cached and will be formatted every <a class="el" href="../../d6/d9f/group__moodlecore.html#gaa731f016ddefcd9a6ec52a6fe3c2194a" title="To use the phpFlickr::call method, pass a string containing the API method you want to use and an ass...">call</a>. Default false.
     <a class="el" href="../../d4/d38/group__filter.html">filter</a>      :   Can be set to false to force filters off, else observes {</dd>
<dd>
 core_external::settings}.
     para        :   If true then the returned string will be wrapped in div tags.
                     Default (different from <a class="el" href="../../d0/de1/group__core.html#ga9cf34d3f4b1d8960c459d4a66144da8e" title="Given text in a variety of format codings, this function returns the text as safe HTML.">format_text</a>) false.
                     Default changed because div tags are not commonly needed.
     newlines    :   If true then lines newline breaks will be converted to HTML newline breaks. Default true.
     context     :   Not used! Using contextid parameter instead.
     overflowdiv :   If set to true the formatted text will be encased in a div with the class no-overflow before being
                     returned. Default false.
     allowid     :   If true then id attributes will not be removed, even when using htmlpurifier. Default (different from
                     <a class="el" href="../../d0/de1/group__core.html#ga9cf34d3f4b1d8960c459d4a66144da8e" title="Given text in a variety of format codings, this function returns the text as safe HTML.">format_text</a>) true. Default changed id attributes are commonly needed.
     blanktarget :   If true all  tags will have target="_blank" added unless target is explicitly specified.
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string&#160;|&#160;null</td><td class="paramname">$text</td><td>The content that may contain ULRs in need of rewriting.
</td></tr>
    <tr><td class="paramtype">string&#160;|&#160;int&#160;|&#160;null</td><td class="paramname">$textformat</td><td>The text format.
</td></tr>
    <tr><td class="paramtype">context</td><td class="paramname">$context</td><td>This parameter and the next two identify the file area to use.
</td></tr>
    <tr><td class="paramtype">string&#160;|&#160;null</td><td class="paramname">$component</td><td></td></tr>
    <tr><td class="paramtype">string&#160;|&#160;null</td><td class="paramname">$filearea</td><td>helps identify the file area.
</td></tr>
    <tr><td class="paramtype">int&#160;|&#160;string&#160;|&#160;null</td><td class="paramname">$itemid</td><td>helps identify the file area.
</td></tr>
    <tr><td class="paramtype">array&#160;|&#160;stdClass&#160;|&#160;null</td><td class="paramname">$options</td><td>text formatting options
</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>text + textformat
</td></tr>
  </table>
  </dd>
</dl>
</pre>
</div>
</div>
<a id="a0daa45aecc7585e9d5a4e264bf570b12" name="a0daa45aecc7585e9d5a4e264bf570b12"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0daa45aecc7585e9d5a4e264bf570b12">&#9670;&#160;</a></span>generate_token()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core_external\util::generate_token </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>$tokentype</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">stdClass</td>          <td class="paramname"><span class="paramname"><em>$service</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>$userid</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">context</td>          <td class="paramname"><span class="paramname"><em>$context</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>$validuntil</em><span class="paramdefsep"> = </span><span class="paramdefval">0</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$iprestriction</em><span class="paramdefsep"> = </span><span class="paramdefval">''</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$name</em><span class="paramdefsep"> = </span><span class="paramdefval">''</span></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Create and return a session linked token. </p>
<p>Token to be used for html embedded client apps that want to communicate with the <a class="el" href="../../d7/d79/namespace_moodle.html" title="&#160;">Moodle</a> server through web services. The token is linked to the current session for the current page request. It is expected this will be called in the script generating the html page that is embedding the client app and that the returned token will be somehow passed into the client app being embedded in the page.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$tokentype</td><td>EXTERNAL_TOKEN_EMBEDDED|EXTERNAL_TOKEN_PERMANENT </td></tr>
    <tr><td class="paramtype">stdClass</td><td class="paramname">$service</td><td>service linked to the token </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$userid</td><td>user linked to the token </td></tr>
    <tr><td class="paramtype">context</td><td class="paramname">$context</td><td></td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$validuntil</td><td>date when the token expired </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$iprestriction</td><td>allowed ip - if 0 or empty then all ips are allowed </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$name</td><td>token name as a note or token identity at the table view. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">string</td><td>generated token </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a35adedeba3f60339c616c3215862a526" name="a35adedeba3f60339c616c3215862a526"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35adedeba3f60339c616c3215862a526">&#9670;&#160;</a></span>generate_token_for_current_user()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core_external\util::generate_token_for_current_user </td>
          <td>(</td>
          <td class="paramtype">stdClass</td>          <td class="paramname"><span class="paramname"><em>$service</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generate or return an existing token for the current authenticated user. </p>
<p>This function is used for creating a valid token for users authenticathing via places, including:</p><ul>
<li>login/token.php</li>
<li>admin/tool/mobile/launch.php.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass</td><td class="paramname">$service</td><td>external service object </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">stdClass</td><td>token object </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="../../d6/da8/classmoodle__exception.html" title="Base Moodle Exception class.">moodle_exception</a></td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a8e335267a67f048d9fd91b57d49e4c28" name="a8e335267a67f048d9fd91b57d49e4c28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e335267a67f048d9fd91b57d49e4c28">&#9670;&#160;</a></span>generate_token_name()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core_external\util::generate_token_name </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generate token name. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">string</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a677141358d58efaea10418fe6b5cc350" name="a677141358d58efaea10418fe6b5cc350"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a677141358d58efaea10418fe6b5cc350">&#9670;&#160;</a></span>get_area_files()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core_external\util::get_area_files </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$contextid</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$component</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$filearea</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$itemid</em><span class="paramdefsep"> = </span><span class="paramdefval">false</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$useitemidinurl</em><span class="paramdefsep"> = </span><span class="paramdefval">true</span></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns all area files (optionally limited by itemid). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$contextid</td><td>context ID </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$component</td><td>component </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$filearea</td><td>file area </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$itemid</td><td>item ID or all files if not specified </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$useitemidinurl</td><td>wether to use the item id in the file URL (modules intro don't use it) </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>of files, compatible with the external_files structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd><a class="el" href="../../d7/d79/namespace_moodle.html" title="&#160;">Moodle</a> 3.2 </dd></dl>

</div>
</div>
<a id="ab3654ed813868676c6b4be445c36edec" name="ab3654ed813868676c6b4be445c36edec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3654ed813868676c6b4be445c36edec">&#9670;&#160;</a></span>get_service_by_id()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core_external\util::get_service_by_id </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>$serviceid</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get a service by its id. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$serviceid</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">stdClass</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a84f7f025ec59f3ced68a46d46bc25603" name="a84f7f025ec59f3ced68a46d46bc25603"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84f7f025ec59f3ced68a46d46bc25603">&#9670;&#160;</a></span>get_service_by_name()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core_external\util::get_service_by_name </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>$name</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get a service by its name. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$name</td><td>The service name. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">stdClass</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a73a4ac60ad45adf6408911e2f21a7403" name="a73a4ac60ad45adf6408911e2f21a7403"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73a4ac60ad45adf6408911e2f21a7403">&#9670;&#160;</a></span>log_token_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core_external\util::log_token_request </td>
          <td>(</td>
          <td class="paramtype">stdClass</td>          <td class="paramname"><span class="paramname"><em>$token</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set the last time a token was sent and trigger the <a class="el" href="../../d4/d40/classcore_1_1event_1_1webservice__token__sent.html" title="Webservice token sent event class.">core::event::webservice_token_sent</a> event. </p>
<p>This function is used when a token is generated by the user via login/token.php or admin/tool/mobile/launch.php. In order to protect the privatetoken, we remove it from the event params.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass</td><td class="paramname">$token</td><td>token object </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac31de25f6fd29f86ab0ae23434088541" name="ac31de25f6fd29f86ab0ae23434088541"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac31de25f6fd29f86ab0ae23434088541">&#9670;&#160;</a></span>validate_courses()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core_external\util::validate_courses </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$courseids</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$courses</em><span class="paramdefsep"> = </span><span class="paramdefval">[]</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$addcontext</em><span class="paramdefsep"> = </span><span class="paramdefval">false</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$keepfails</em><span class="paramdefsep"> = </span><span class="paramdefval">false</span></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Validate a list of courses, returning the complete course objects for valid courses. </p>
<p>Each course has an additional 'contextvalidated' field, this will be set to true unless you set $keepfails, in which case it will be false if validation fails for a course.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$courseids</td><td>A list of course ids </td></tr>
    <tr><td class="paramtype">array</td><td class="paramname">$courses</td><td>An array of courses already pre-fetched, indexed by course id. </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$addcontext</td><td>True if the returned course object should include the full context object. </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$keepfails</td><td>True to keep all the course objects even if validation fails </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">array</td><td>An array of courses and the validation warnings </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a22543643b8775787127c66ee160daacb" name="a22543643b8775787127c66ee160daacb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22543643b8775787127c66ee160daacb">&#9670;&#160;</a></span>validate_format()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static core_external\util::validate_format </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$format</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Validate text field format against known FORMAT_XXX. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$format</td><td>the format to validate </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">string</td><td>the validated format </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="../../d6/da8/classmoodle__exception.html" title="Base Moodle Exception class.">moodle_exception</a></td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd><a class="el" href="../../d7/d79/namespace_moodle.html" title="&#160;">Moodle</a> 2.3 </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>lib/external/classes/<b>util.php</b></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Mar 3 2024 02:32:46 for Moodle PHP Documentation by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
